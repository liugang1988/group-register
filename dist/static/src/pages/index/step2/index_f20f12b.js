define("src/pages/index/step2/index",function(require,exports,module){"use strict";function a(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(exports,"__esModule",{value:!0});var c=require("src/utils/validatorMixin"),h=a(c),v=require("src/pages/index/data/getGroupDetail"),g=a(v),b=require("src/pages/index/data/getSelectGroup"),$=a(b),y=require("src/utils/validators");exports["default"]={mixins:[h["default"]],template:'<div class="m-box"><ui-form type="v" v-if="!groupId"><ui-form-item label="网店名称：" :tips="getErrorText($v.groupName, msg.groupName)" :state="$v.groupName.$error" :required="true"><div class="input-search w50"><ui-autocomplete v-model="groupName" placeholder="请填写网店名称" :fetch-suggestions="_search" @select="select" @blur="$v.groupName.$touch()" @focus="$v.groupName.$reset()"></ui-autocomplete><div class="m-form-item__text"><span class="f-c-red">{{groupName.length || 0}}/30</span>字</div></div></ui-form-item><ui-form-item label="简介：" :tips="getErrorText($v.intro, msg.intro)" :state="$v.intro.$error"><textarea class="u-textarea w80" placeholder="请填写网店简介" v-model.trim="intro" @blur="$v.intro.$touch()" @focus="$v.intro.$reset()"></textarea><div class="m-form-item__text"><span class="f-c-red">{{intro.length || 0}}/2000</span>字</div></ui-form-item><ui-form-item label="教学科目：" :required="true" :tips="getErrorText($v.subjects, msg.subjects)" :state="$v.subjects.$error"><ui-checkbox v-for="item of subjectsItems" v-model="subjects" :label="item.id" @change="$v.subjects.$touch()">{{item.name}}</ui-checkbox></ui-form-item><ui-form-item label="特色科目：" :tips="getErrorText($v.featureSubject, msg.featureSubject)" :state="$v.featureSubject.$error"><input class="u-input-text w50" type="text" placeholder="请填写特色科目" v-model.trim="featureSubject" @blur="$v.featureSubject.$touch()" @focus="$v.featureSubject.$reset()"><div class="m-form-item__text"><span class="f-c-red">{{featureSubject.length || 0}}/20</span>字</div></ui-form-item><ui-form-item label="教学地址：" :required="true" :tips="getErrorText($v.address, msg.address)" :state="$v.address.$error"><select class="u-select w15" v-model="provinceVal" @change="getCity(provinceVal)"><option value="">请选择省</option><option :value="item.name" v-for="item in province">{{item.name}}</option></select><select class="u-select w15" v-model="cityVal" @change="getDistrict(cityVal)"><option value="">请选择市</option><option :value="item.name" v-for="item in city">{{item.name}}</option></select><select class="u-select w15" v-model="districtVal" @change="getTrade(districtVal)"><option value="">请选择区</option><option :value="item.name" v-for="item in district">{{item.name}}</option></select><select class="u-select w15" v-model="tradeVal" @change="getRegion(tradeVal)"><option value="">请选择商圈</option><option :value="item.name" v-for="item in trade">{{item.name}}</option></select><input class="u-input-text w40" type="text" placeholder="请输入详细地址" v-model.trim="address" @blur="$v.address.$touch()" @focus="$v.address.$reset()"><div class="m-form-item__text"><span class="f-c-red">{{address.length || 0}}/40</span>字</div></ui-form-item><ui-form-item label="E-mail：" :tips="getErrorText($v.contactMail, msg.contactMail)" :state="$v.contactMail.$error"><input class="u-input-text w50" type="text" placeholder="请填写email" v-model="contactMail" @blur="$v.contactMail.$touch()" @focus="$v.contactMail.$reset()"></ui-form-item><ui-form-item label="联系电话：" :tips="getErrorText($v.telephone, msg.telephone)" :state="$v.telephone.$error"><input class="u-input-text w50" type="text" placeholder="座机请填写区号，如：0755-14852120" v-model="telephone" @blur="$v.telephone.$touch()" @focus="$v.telephone.$reset()"></ui-form-item><ui-form-item label="机构图片："><ui-form-upload-img :items="pics" @remove="removeImg" @upload="isShowImageCropper=true"></ui-form-upload-img></ui-form-item><ui-form-item label="负责人：" :required="true" :tips="getErrorText($v.contactName, msg.contactName)" :state="$v.contactName.$error"><input class="u-input-text w50" type="text" placeholder="请填写负责人" v-model="contactName" @blur="$v.contactName.$touch()" @focus="$v.contactName.$reset()"></ui-form-item><ui-form-item label="负责人电话：" :required="true" :tips="getErrorText($v.contactPhone, msg.contactPhone)" :state="$v.contactPhone.$error"><input class="u-input-text w50" type="text" placeholder="请填写负责人电话" v-model="contactPhone" @blur="$v.contactPhone.$touch()" @focus="$v.contactPhone.$reset()"></ui-form-item><ui-form-item><ui-button type="primary" @click.native="submit">提交</ui-button></ui-form-item></ui-form><ui-form type="v" v-else><ui-form-item label="网店名称：" :required="true">{{groupName}}<ui-button type="primary" @click.native="reSelect">换一个网店</ui-button></ui-form-item><template v-if="info"><ui-form-item label="简介：">{{info.intro}}</ui-form-item><ui-form-item label="教学科目：">{{info.subjects}}</ui-form-item><ui-form-item label="特色科目：">{{info.featureSubject}}</ui-form-item><ui-form-item label="教学地址：">{{info.address}}</ui-form-item><ui-form-item label="Email：">{{info.contactMail}}</ui-form-item><ui-form-item label="联系电话：">{{info.telephone}}</ui-form-item><ui-form-item label="机构图片："><div class="m-form-upload-img"><div class="img" v-for="(item,index) of info.pics"><img :src="item.uri"></div></div></ui-form-item><ui-form-item label="负责人：">{{info.contactName}}</ui-form-item><ui-form-item label="负责人电话：">{{info.contactPhone}}</ui-form-item></template><div v-else>正在加载信息...</div><ui-form-item><ui-button type="primary" @click.native="submit">提交</ui-button></ui-form-item></ui-form><div style="display:none"><ui-dialog title="上传图片" :visible="isShowImageCropper" @close="isShowImageCropper=false"><ui-image-cropper @on-error="uploadError" @on-success="uploadSuccess"></ui-image-cropper></ui-dialog></div></div>',props:{errorStep:{"default":!1},currentStep:{"default":1}},data:function(){return{groupId:"",groupName:"",intro:"",subjects:[],featureSubject:"",address:"",regionId:"",contactMail:"",telephone:"",contactName:"",contactPhone:"",pics:[],subjectsItems:[],areaData:[],province:[],city:[],district:[],trade:[],provinceVal:"",cityVal:"",districtVal:"",tradeVal:"",provinceIndex:null,cityIndex:null,districtIndex:null,tradeIndex:null,fullAddress:"",isInfor:!1,info:{},isSubmit:!1,isShowImageCropper:!1,uploader:{},msg:{groupName:[{type:"required",text:"网店名称不能为空！"},{type:"maxLength",text:"网店名称不能超过30字！"},{type:"noSpace",text:"网店名称不能有空格"}],intro:[{type:"maxLength",text:"网店介绍不能超过2000字！"}],subjects:[{type:"required",text:"请选择教学科目！"}],featureSubject:[{type:"maxLength",text:"特色科目不能超过20字！"},{type:"noSpace",text:"特色科目不能有空格"}],address:[{type:"required",text:"机构地址不能为空！"},{type:"maxLength",text:"机构地址不能超过40字！"},{type:"noSpace",text:"机构地址不能有空格"}],regionId:[{type:"required",text:"区域编号不能为空！"}],contactMail:[{type:"email",text:"请填写正确的邮箱！"}],telephone:[{type:"isLandlines",text:"请填写正确的联系电话！"}],contactName:[{type:"required",text:"负责人不能为空！"},{type:"maxLength",text:"负责人不能超过15字！"},{type:"noSpace",text:"负责人不能有空格"}],contactPhone:[{type:"required",text:"负责人电话不能为空！"},{type:"isMobile",text:"请正确填写负责人电话！"}]}}},validations:{groupName:{required:y.required,maxLength:y.maxLength(30),noSpace:y.noSpace},intro:{maxLength:function(a){return!y.required(a)||y.maxLength(2e3)(a)}},subjects:{required:y.required},featureSubject:{maxLength:function(a){return!y.required(a)||y.maxLength(20)(a)},noSpace:y.noSpace},address:{required:y.required,maxLength:y.maxLength(40),noSpace:y.noSpace},regionId:{required:y.required},contactMail:{isEmail:function(a){return!y.required(a)||y.isEmail(a)}},telephone:{isLandlines:function(a){return!y.required(a)||y.isLandlines(a)}},contactName:{required:y.required,maxLength:y.maxLength(15),noSpace:y.noSpace},contactPhone:{required:y.required,isMobile:y.isMobile},all:["groupName","intro","subjects","featureSubject","address","regionId","contactMail","telephone","contactName","contactPhone"]},methods:{reSelect:function(){this.groupId="",this.groupName=""},select:function(a){var c=this,h=this.groupId=a.groupId;g["default"].getValue(h).then(function(d){d.key===h&&(c.info=d.value.data)})},_search:function(){var a=this;return $["default"].getValue(this.groupName).then(function(d){return d.key===a.groupName?d.value.data.map(function(a){return a.value=a.groupName,a}):null})},uploadSuccess:function(a,c){this.pics.push({key:c,url:a}),this.isShowImageCropper=!1},uploadError:function(a){this.toast({content:a,type:"warn"})},removeImg:function(a){this.pics.splice(a,1)},getInfor:function(){var a=this;this.$http.get("/api/group/v3/auto/group/info").then(function(c){var h=c.data;h&&(a.isInfor=!0),a.groupName=h.groupName,a.intro=h.intro,a.featureSubject=h.featureSubject,a.contactMail=h.contactMail,a.telephone=h.telephone,a.contactName=h.contactName,a.contactPhone=h.contactPhone;var v=h.subjects.split(" "),g=v.length,b=[];a.subjectsItems.forEach(function(a){for(var i=0;g>i;i++)v[i]===a.name&&b.push(a.id)}),a.subjects=b,a.pics=h.pics.map(function(a){return{key:a.uri,url:a.url}}),a.address=h.address,a.regionId=h.regionId},function(){})},getSubject:function(){var a=this;this.$http.get("/api/cbs/v3/course/category/list").then(function(c){a.subjectsItems=c.data},function(c){a.toast({content:c.statusText,type:"warn"})})},getAreaData:function(){var a=this;this.$http.get("/api/cbs/v3/area/all").then(function(c){a.areaData=c.data,a.getProvince(),a.errorStep&&a.getInfor()},function(c){a.toast({content:c.statusText,type:"warn"})})},getProvince:function(){var a=this;this.areaData.map(function(c){return a.province.push({id:c.id,name:c.name}),a.province})},getCity:function(a){if(""!==a){if(this.provinceVal){for(var c=this.areaData,h=c.length,i=0;h>i;i++)c[i].name===a&&(this.provinceIndex=i);this.city=this.areaData[this.provinceIndex].areas}}else this.city=[],this.district=[],this.trade=[],this.cityVal="",this.districtVal="",this.tradeVal=""},getDistrict:function(a){if(""!==a){if(this.provinceVal&&this.cityVal){for(var c=this.areaData[this.provinceIndex].areas,h=c.length,i=0;h>i;i++)c[i].name===a&&(this.cityIndex=i);this.district=this.areaData[this.provinceIndex].areas[this.cityIndex].areas}}else this.district=[],this.trade=[],this.districtVal="",this.tradeVal=""},getTrade:function(a){if(""!==a){if(this.provinceVal&&this.cityVal&&this.districtVal){for(var c=this.areaData[this.provinceIndex].areas[this.cityIndex].areas,h=c.length,i=0;h>i;i++)c[i].name===a&&(this.districtIndex=i);this.trade=this.areaData[this.provinceIndex].areas[this.cityIndex].areas[this.districtIndex].areas}}else this.trade=[],this.tradeVal=""},getRegion:function(a){if(this.provinceVal&&this.cityVal&&this.districtVal&&this.tradeVal){for(var c=this.areaData[this.provinceIndex].areas[this.cityIndex].areas[this.districtIndex].areas,h=c.length,i=0;h>i;i++)c[i].name===a&&(this.tradeIndex=i);this.regionId=this.areaData[this.provinceIndex].areas[this.cityIndex].areas[this.districtIndex].areas[this.tradeIndex].id}},commit:function(a){var c=this;this.$http.post("/api/group/v3/auto/group/submit",a).then(function(){c.$emit("next"),c.isSubmit=!1},function(a){c.isSubmit=!1,c.toast({content:a.statusText,type:"warn"})})},submit:function(){var a="";if(this.groupId)a={groupId:this.groupId};else{if(this.$v.all.$touch(),this.$v.all.$error)return;a={groupName:this.groupName,intro:this.intro,subjects:this.subjects.toString(),featureSubject:this.featureSubject,address:this.address,regionId:this.regionId,contactMail:this.contactMail,telephone:this.telephone,contactName:this.contactName,contactPhone:this.contactPhone,pics:this.pics.map(function(a){return a.key}).join(",")}}this.isSubmit||(this.isSubmit=!0,this.commit(a))}},created:function(){this.getSubject(),this.getAreaData()}},module.exports=exports["default"]});