define("src/components/image-cropper/index",function(require,exports,module){"use strict";function a(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(exports,"__esModule",{value:!0});var g=require("src/components/image-cropper/cropper"),h=a(g),c=require("src/components/image-cropper/upload"),v=a(c),A=require("src/components/image-cropper/getImageSize"),b=a(A),y=require("src/components/button/index"),w=a(y),z={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/jpeg",webp:"image/webp"},H=["上传出错","上传文件大小不符合要求","图片长宽尺寸不符合要求","图片类型不符合要求","裁剪出错"];exports["default"]={template:'<div class="img-cropper"><p v-show="targetHeight || targetWidth">推荐尺寸：{{targetWidth}}*{{targetHeight}}</p><p>图片格式必须为：{{_imageType}}; 不可大于{{_size}}</p><div class="choose-img" v-show="!type"><label class="uploader"><input type="file" @change="change($event)" ref="filebtn" id="file"><div class="btn btn--primary" type="primary">选择图片</div></label></div><div v-show="type"><div class="preview-container"><div class="image-container target" ref="imgbox" :style="{width:boxWidth+\'px\',\'height\':boxHeight+\'px\'}"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="noavatar" ref="img"></div></div><div class="img-cropper__ft"><ui-button type="primary" @click.native="getImg"><i class="icon-upload"></i> {{!isUpload?\'上传\':\'正在上传...\'}}</ui-button><label class="uploader"><input type="file" @change="change($event)" ref="filebtn"><div class="btn btn--gray" type="primary">重新选择</div></label></div></div></div>',components:{uiButton:w["default"]},props:{boxWidth:{"default":500},boxHeight:{"default":500},targetWidth:{"default":0},targetHeight:{"default":0},minWidth:{"default":100},minHeight:{"default":100},imageType:{"default":"jpg|jpeg|png|webp"},maxSize:{"default":10485760},compressSize:{"default":204800}},data:function(){return{cropper:null,rect:null,imgPreview:"",naturalWidth:0,naturalHeight:0,isUpload:!1,type:""}},computed:{_size:function(){var a=this.maxSize,g="b";return a>1024&&(a/=1024,g="k",a>1024&&(a/=1024,g="M")),parseFloat(a.toFixed(2))+g},_imageType:function(){return this.imageType.replace(/\|/g,"，")}},methods:{vSize:function(a){var g=this,h=this.cropper;b["default"](a,function(c,v){if(g.targetWidth&&c<g.targetWidth||g.targetHeight&&v<g.targetHeight){var A=g.targetWidth&&c<g.targetWidth?"宽度不能小于"+g.targetWidth+"px ":"";return A+=g.targetHeight&&v<g.targetHeight?"高度不能小于"+g.targetHeight+"px":"",g.$emit("on-error",A),g.type="",void(g.$refs.filebtn.value="")}g.naturalWidth=c,g.naturalHeight=v,h.setImage(a,c,v)})},change:function(e){var a=this,g=e.target,h=g.value;if(h){var c=this.imageType.replace(/\s*[|,，、\s]\s*/g,"|");if(!new RegExp("\\.("+c+")$","i").test(h))return void this.$emit("on-error",H[3]);if(g.files){if(g.files[0]&&g.files[0].size>this.maxSize)return this.$refs.filebtn.value="",void this.$emit("on-error",H[1]);this.size=g.files[0].size}else this.size=0;if(this.type=h.substr(h.lastIndexOf(".")+1).toLowerCase(),"undefined"!=typeof FileReader){var v=new FileReader;v.onload=function(g){a.vSize(g.target.result)},g.files&&g.files[0]&&v.readAsDataURL(g.files[0])}else g.select(),g.blur(),this.vSize(document.selection.createRange().text)}},getImg:function(){if(this.rect){var a=this.rect,g=a.width,h=a.height,c=this.targetWidth||g,v=this.targetHeight||h,A=document.createElement("canvas"),b=A.getContext("2d");A.width=c,A.height=v,b.drawImage(this.$refs.img,a.left,a.top,g,h,0,0,c,v);var r=1;if(this.size){var y=this.size*v*c/(this.naturalWidth*this.naturalHeight);this.compressSize<y&&(r=this.compressSize/y)}else r=.5;this.imgPreview=A.toDataURL(z[this.type]||void 0,r),this.upload(this.imgPreview)}},upload:function(a){var g=this;this.isUpload=!0,v["default"](a,{success:function(a,h){g.isUpload=!1,g.$emit("on-success",a,h),g.type="";var c=document.getElementById("file");c.value=""},progress:function(p){g.$emit("on-progress",p)},fail:function(a){g.isUpload=!1,g.$emit("on-error",H[0])}})}},mounted:function(){var a=this;this.cropper=new h["default"]({element:this.$refs.imgbox,targetWidth:this.targetWidth,targetHeight:this.targetHeight,onCroppedRectChange:function(g){a.rect=g},onError:function(){a.$emit("on-error",H[4])}})}},module.exports=exports["default"]});