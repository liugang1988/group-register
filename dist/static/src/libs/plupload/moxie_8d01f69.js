!function(exports,a){"use strict";function require(a,h){for(var module,v=[],i=0;i<a.length;++i){if(module=g[a[i]]||c(a[i]),!module)throw"module definition dependecy not found: "+a[i];v.push(module)}h.apply(null,v)}function define(c,h,v){if("string"!=typeof c)throw"invalid module definition, module id must be defined and be a string";if(h===a)throw"invalid module definition, dependencies must be specified";if(v===a)throw"invalid module definition, definition function must be specified";require(h,function(){g[c]=v.apply(null,arguments)})}function c(a){for(var c=exports,h=a.split(/[.\/]/),fi=0;fi<h.length;++fi){if(!c[h[fi]])return;c=c[h[fi]]}return c}function h(c){for(var i=0;i<c.length;i++){for(var h=exports,v=c[i],y=v.split(/[.\/]/),fi=0;fi<y.length-1;++fi)h[y[fi]]===a&&(h[y[fi]]={}),h=h[y[fi]];h[y[y.length-1]]=g[v]}}var g={};define("moxie/core/utils/Basic",[],function(){var a=function(o){var a;return o===a?"undefined":null===o?"null":o.nodeType?"node":{}.toString.call(o).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},c=function(g){var v;return h(arguments,function(y,i){i>0&&h(y,function(h,y){h!==v&&(a(g[y])===a(h)&&~w(a(h),["array","object"])?c(g[y],h):g[y]=h)})}),g},h=function(a,c){var h,g,i,v;if(a){try{h=a.length}catch(ex){h=v}if(h===v){for(g in a)if(a.hasOwnProperty(g)&&c(a[g],g)===!1)return}else for(i=0;h>i;i++)if(c(a[i],i)===!1)return}},g=function(c){var h;if(!c||"object"!==a(c))return!0;for(h in c)return!1;return!0},v=function(c,h){function g(i){"function"===a(c[i])&&c[i](function(a){++i<v&&!a?g(i):h(a)})}var i=0,v=c.length;"function"!==a(h)&&(h=function(){}),c&&c.length||h(),g(i)},y=function(a,c){var g=0,v=a.length,y=new Array(v);h(a,function(a,i){a(function(a){if(a)return c(a);var h=[].slice.call(arguments);h.shift(),y[i]=h,g++,g===v&&(y.unshift(null),c.apply(this,y))})})},w=function(a,c){if(c){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(c,a);for(var i=0,h=c.length;h>i;i++)if(c[i]===a)return i}return-1},E=function(c,h){var g=[];"array"!==a(c)&&(c=[c]),"array"!==a(h)&&(h=[h]);for(var i in c)-1===w(c[i],h)&&g.push(c[i]);return g.length?g:!1},R=function(a,c){var g=[];return h(a,function(a){-1!==w(a,c)&&g.push(a)}),g.length?g:null},_=function(a){var i,c=[];for(i=0;i<a.length;i++)c[i]=a[i];return c},b=function(){var a=0;return function(c){var i,h=(new Date).getTime().toString(32);for(i=0;5>i;i++)h+=Math.floor(65535*Math.random()).toString(32);return(c||"o_")+h+(a++).toString(32)}}(),T=function(a){return a?String.prototype.trim?String.prototype.trim.call(a):a.toString().replace(/^\s*/,"").replace(/\s*$/,""):a},S=function(a){if("string"!=typeof a)return a;var c,h={t:1099511627776,g:1073741824,m:1048576,k:1024};return a=/^([0-9]+)([mgk]?)$/.exec(a.toLowerCase().replace(/[^0-9mkg]/g,"")),c=a[2],a=+a[1],h.hasOwnProperty(c)&&(a*=h[c]),a};return{guid:b,typeOf:a,extend:c,each:h,isEmptyObj:g,inSeries:v,inParallel:y,inArray:w,arrayDiff:E,arrayIntersect:R,toArray:_,trim:T,parseSizeStr:S}}),define("moxie/core/I18n",["moxie/core/utils/Basic"],function(a){var c={};return{addI18n:function(h){return a.extend(c,h)},translate:function(a){return c[a]||a},_:function(a){return this.translate(a)},sprintf:function(c){var h=[].slice.call(arguments,1);return c.replace(/%[a-z]/g,function(){var c=h.shift();return"undefined"!==a.typeOf(c)?c:""})}}}),define("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(a,c){var h="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",g={mimes:{},extensions:{},addMimeType:function(a){var i,c,h,g=a.split(/,/);for(i=0;i<g.length;i+=2){for(h=g[i+1].split(/ /),c=0;c<h.length;c++)this.mimes[h[c]]=g[i];this.extensions[g[i]]=h}},extList2mimes:function(c,h){var g,i,v,y,w=this,E=[];for(i=0;i<c.length;i++)for(g=c[i].extensions.split(/\s*,\s*/),v=0;v<g.length;v++){if("*"===g[v])return[];if(y=w.mimes[g[v]])-1===a.inArray(y,E)&&E.push(y);else{if(!h||!/^\w+$/.test(g[v]))return[];E.push("."+g[v])}}return E},mimes2exts:function(c){var h=this,g=[];return a.each(c,function(c){if("*"===c)return g=[],!1;var m=c.match(/^(\w+)\/(\*|\w+)$/);m&&("*"===m[2]?a.each(h.extensions,function(a,c){new RegExp("^"+m[1]+"/").test(c)&&[].push.apply(g,h.extensions[c])}):h.extensions[c]&&[].push.apply(g,h.extensions[c]))}),g},mimes2extList:function(h){var g=[],v=[];return"string"===a.typeOf(h)&&(h=a.trim(h).split(/\s*,\s*/)),v=this.mimes2exts(h),g.push({title:c.translate("Files"),extensions:v.length?v.join(","):"*"}),g.mimes=h,g},getFileExtension:function(a){var c=a&&a.match(/\.([^.]+)$/);return c?c[1].toLowerCase():""},getFileMime:function(a){return this.mimes[this.getFileExtension(a)]||""}};return g.addMimeType(h),g}),define("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(a){function c(a,c,h){var i=0,x=0,g=0,v={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},y=function(a){return a=(""+a).replace(/[_\-+]/g,"."),a=a.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),a.length?a.split("."):[-8]},w=function(a){return a?isNaN(a)?v[a]||-7:parseInt(a,10):0};for(a=y(a),c=y(c),x=Math.max(a.length,c.length),i=0;x>i;i++)if(a[i]!=c[i]){if(a[i]=w(a[i]),c[i]=w(c[i]),a[i]<c[i]){g=-1;break}if(a[i]>c[i]){g=1;break}}if(!h)return g;switch(h){case">":case"gt":return g>0;case">=":case"ge":return g>=0;case"<=":case"le":return 0>=g;case"==":case"=":case"eq":return 0===g;case"<>":case"!=":case"ne":return 0!==g;case"":case"<":case"lt":return 0>g;default:return null}}var h=function(a){var c="",h="?",g="function",v="undefined",y="object",w="major",E="name",R="version",_={has:function(a,c){return-1!==c.toLowerCase().indexOf(a.toLowerCase())},lowerize:function(a){return a.toLowerCase()}},b={rgx:function(){for(var c,h,w,p,q,E,R,i=0,_=arguments;i<_.length;i+=2){var b=_[i],T=_[i+1];if(typeof c===v){c={};for(p in T)q=T[p],typeof q===y?c[q[0]]=a:c[q]=a}for(h=w=0;h<b.length;h++)if(E=b[h].exec(this.getUA())){for(p=0;p<T.length;p++)R=E[++w],q=T[p],typeof q===y&&q.length>0?2==q.length?c[q[0]]=typeof q[1]==g?q[1].call(this,R):q[1]:3==q.length?c[q[0]]=typeof q[1]!==g||q[1].exec&&q[1].test?R?R.replace(q[1],q[2]):a:R?q[1].call(this,R,q[2]):a:4==q.length&&(c[q[0]]=R?q[3].call(this,R.replace(q[1],q[2])):a):c[q]=R?R:a;break}if(E)break}return c},str:function(c,g){for(var i in g)if(typeof g[i]===y&&g[i].length>0){for(var v=0;v<g[i].length;v++)if(_.has(g[i][v],c))return i===h?a:i}else if(_.has(g[i],c))return i===h?a:i;return c}},T={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},S={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[E,R,w],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[E,"Opera"],R,w],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[E,R,w],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[E,"IE"],R,w],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[E,"Yandex"],R,w],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[E,/_/g," "],R,w],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[E,R,w],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[E,"Dolphin"],R,w],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[E,"Chrome"],R,w],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[E,"Android Browser"],R,w],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[R,w,[E,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[R,w,E],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[E,[w,b.str,T.browser.oldsafari.major],[R,b.str,T.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[E,R,w],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[E,"Netscape"],R,w],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[E,R,w]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[E,R],[/rv\:([\w\.]+).*(gecko)/i],[R,E]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[E,[R,b.str,T.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[E,"Windows"],[R,b.str,T.os.windows.version]],[/\((bb)(10);/i],[[E,"BlackBerry"],R],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[E,R],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[E,"Symbian"],R],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[E,"Firefox OS"],R],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[E,R],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[E,"Chromium OS"],R],[/(sunos)\s?([\w\.]+\d)*/i],[[E,"Solaris"],R],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[E,R],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[E,"iOS"],[R,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[E,[R,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[E,R]]},A=function(a){var h=a||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:c);this.getBrowser=function(){return b.rgx.apply(this,S.browser)},this.getEngine=function(){return b.rgx.apply(this,S.engine)},this.getOS=function(){return b.rgx.apply(this,S.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return h},this.setUA=function(a){return h=a,this},this.setUA(h)};return(new A).getResult()}(),g=function(){var c={define_property:function(){return!1}(),create_canvas:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),return_response_type:function(c){try{if(-1!==a.inArray(c,["","text","document"]))return!0;if(window.XMLHttpRequest){var h=new XMLHttpRequest;if(h.open("get","/"),"responseType"in h)return h.responseType=c,h.responseType!==c?!1:!0}}catch(ex){}return!1},use_data_uri:function(){var du=new Image;return du.onload=function(){c.use_data_uri=1===du.width&&1===du.height},setTimeout(function(){du.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return c.use_data_uri&&("IE"!==v.browser||v.version>=9)},use_data_uri_of:function(a){return c.use_data_uri&&33e3>a||c.use_data_uri_over32kb()},use_fileinput:function(){var a=document.createElement("input");return a.setAttribute("type","file"),!a.disabled}};return function(h){var g=[].slice.call(arguments);return g.shift(),"function"===a.typeOf(c[h])?c[h].apply(this,g):!!c[h]}}(),v={can:g,browser:h.browser.name,version:parseFloat(h.browser.major),os:h.os.name,osVersion:h.os.version,verComp:c,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return v.OS=v.os,v}),define("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(a){var c=function(a){return"string"!=typeof a?a:document.getElementById(a)},h=function(a,c){if(!a.className)return!1;var h=new RegExp("(^|\\s+)"+c+"(\\s+|$)");return h.test(a.className)},g=function(a,c){h(a,c)||(a.className=a.className?a.className.replace(/\s+$/,"")+" "+c:c)},v=function(a,c){if(a.className){var h=new RegExp("(^|\\s+)"+c+"(\\s+|$)");a.className=a.className.replace(h,function(a,c,h){return" "===c&&" "===h?" ":""})}},y=function(a,c){return a.currentStyle?a.currentStyle[c]:window.getComputedStyle?window.getComputedStyle(a,null)[c]:void 0},w=function(c,h){function g(a){var c,h,x=0,g=0;return a&&(h=a.getBoundingClientRect(),c="CSS1Compat"===R.compatMode?R.documentElement:R.body,x=h.left+c.scrollLeft,g=h.top+c.scrollTop),{x:x,y:g}}var v,y,w,x=0,E=0,R=document;if(c=c,h=h||R.body,c&&c.getBoundingClientRect&&"IE"===a.browser&&(!R.documentMode||R.documentMode<8))return y=g(c),w=g(h),{x:y.x-w.x,y:y.y-w.y};for(v=c;v&&v!=h&&v.nodeType;)x+=v.offsetLeft||0,E+=v.offsetTop||0,v=v.offsetParent;for(v=c.parentNode;v&&v!=h&&v.nodeType;)x-=v.scrollLeft||0,E-=v.scrollTop||0,v=v.parentNode;return{x:x,y:E}},E=function(a){return{w:a.offsetWidth||a.clientWidth,h:a.offsetHeight||a.clientHeight}};return{get:c,hasClass:h,addClass:g,removeClass:v,getStyle:y,getPos:w,getSize:E}}),define("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(a){function c(a,c){var h;for(h in a)if(a[h]===c)return h;return null}return{RuntimeError:function(){function h(a){this.code=a,this.name=c(g,a),this.message=this.name+": RuntimeError "+this.code}var g={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return a.extend(h,g),h.prototype=Error.prototype,h}(),OperationNotAllowedException:function(){function c(a){this.code=a,this.name="OperationNotAllowedException"}return a.extend(c,{NOT_ALLOWED_ERR:1}),c.prototype=Error.prototype,c}(),ImageError:function(){function h(a){this.code=a,this.name=c(g,a),this.message=this.name+": ImageError "+this.code}var g={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return a.extend(h,g),h.prototype=Error.prototype,h}(),FileException:function(){function h(a){this.code=a,this.name=c(g,a),this.message=this.name+": FileException "+this.code}var g={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return a.extend(h,g),h.prototype=Error.prototype,h}(),DOMException:function(){function h(a){this.code=a,this.name=c(g,a),this.message=this.name+": DOMException "+this.code}var g={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return a.extend(h,g),h.prototype=Error.prototype,h}(),EventException:function(){function c(a){this.code=a,this.name="EventException"}return a.extend(c,{UNSPECIFIED_EVENT_TYPE_ERR:0}),c.prototype=Error.prototype,c}()}}),define("moxie/core/EventTarget",["moxie/core/Exceptions","moxie/core/utils/Basic"],function(x,a){function c(){var c={};a.extend(this,{uid:null,init:function(){this.uid||(this.uid=a.guid("uid_"))},addEventListener:function(h,g,v,y){var w,E=this;return h=a.trim(h),/\s/.test(h)?void a.each(h.split(/\s+/),function(a){E.addEventListener(a,g,v,y)}):(h=h.toLowerCase(),v=parseInt(v,10)||0,w=c[this.uid]&&c[this.uid][h]||[],w.push({fn:g,priority:v,scope:y||this}),c[this.uid]||(c[this.uid]={}),void(c[this.uid][h]=w))},hasEventListener:function(a){return a?!(!c[this.uid]||!c[this.uid][a]):!!c[this.uid]},removeEventListener:function(h,g){h=h.toLowerCase();var i,v=c[this.uid]&&c[this.uid][h];if(v){if(g){for(i=v.length-1;i>=0;i--)if(v[i].fn===g){v.splice(i,1);break}}else v=[];v.length||(delete c[this.uid][h],a.isEmptyObj(c[this.uid])&&delete c[this.uid])}},removeAllEventListeners:function(){c[this.uid]&&delete c[this.uid]},dispatchEvent:function(h){var g,v,y,w,E,R={},_=!0;if("string"!==a.typeOf(h)){if(w=h,"string"!==a.typeOf(w.type))throw new x.EventException(x.EventException.UNSPECIFIED_EVENT_TYPE_ERR);h=w.type,w.total!==E&&w.loaded!==E&&(R.total=w.total,R.loaded=w.loaded),R.async=w.async||!1}if(-1!==h.indexOf("::")?!function(a){g=a[0],h=a[1]}(h.split("::")):g=this.uid,h=h.toLowerCase(),v=c[g]&&c[g][h]){v.sort(function(a,c){return c.priority-a.priority}),y=[].slice.call(arguments),y.shift(),R.type=h,y.unshift(R);var b=[];a.each(v,function(a){y[0].target=a.scope,b.push(R.async?function(c){setTimeout(function(){c(a.fn.apply(a.scope,y)===!1)},1)}:function(c){c(a.fn.apply(a.scope,y)===!1)})}),b.length&&a.inSeries(b,function(a){_=!a})}return _},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(c){var h;"array"!==a.typeOf(c)&&(c=[c]);for(var i=0;i<c.length;i++)h="on"+c[i],"function"===a.typeOf(this[h])?this.addEventListener(c[i],this[h]):"undefined"===a.typeOf(this[h])&&(this[h]=null)}})}return c.instance=new c,c}),define("moxie/core/utils/Encode",[],function(){var a=function(a){return unescape(encodeURIComponent(a))},c=function(a){return decodeURIComponent(escape(a))},h=function(a,h){if("function"==typeof window.atob)return h?c(window.atob(a)):window.atob(a);var g,v,y,w,E,R,_,b,T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=0,S=0,A="",O=[];if(!a)return a;a+="";do w=T.indexOf(a.charAt(i++)),E=T.indexOf(a.charAt(i++)),R=T.indexOf(a.charAt(i++)),_=T.indexOf(a.charAt(i++)),b=w<<18|E<<12|R<<6|_,g=b>>16&255,v=b>>8&255,y=255&b,O[S++]=64==R?String.fromCharCode(g):64==_?String.fromCharCode(g,v):String.fromCharCode(g,v,y);while(i<a.length);return A=O.join(""),h?c(A):A},g=function(c,h){if(h&&a(c),"function"==typeof window.btoa)return window.btoa(c);var g,v,y,w,E,R,_,b,T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=0,S=0,A="",O=[];if(!c)return c;do g=c.charCodeAt(i++),v=c.charCodeAt(i++),y=c.charCodeAt(i++),b=g<<16|v<<8|y,w=b>>18&63,E=b>>12&63,R=b>>6&63,_=63&b,O[S++]=T.charAt(w)+T.charAt(E)+T.charAt(R)+T.charAt(_);while(i<c.length);A=O.join("");var r=c.length%3;return(r?A.slice(0,r-3):A)+"===".slice(r||3)};return{utf8_encode:a,utf8_decode:c,atob:h,btoa:g}}),define("moxie/runtime/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(a,c,h){function g(h,v,w,E,R){var _,b=this,T=a.guid(v+"_"),S=R||"browser";h=h||{},y[T]=this,w=a.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},w),h.preferred_caps&&(S=g.getMode(E,h.preferred_caps,S)),_=function(){var c={};return{exec:function(a,h,g,v){return _[h]&&(c[a]||(c[a]={context:this,instance:new _[h]}),c[a].instance[g])?c[a].instance[g].apply(this,v):void 0},removeInstance:function(a){delete c[a]},removeAllInstances:function(){var h=this;a.each(c,function(c,g){"function"===a.typeOf(c.instance.destroy)&&c.instance.destroy.call(c.context),h.removeInstance(g)})}}}(),a.extend(this,{initialized:!1,uid:T,type:v,mode:g.getMode(E,h.required_caps,S),shimid:T+"_container",clients:0,options:h,can:function(c,h){var v=arguments[2]||w;if("string"===a.typeOf(c)&&"undefined"===a.typeOf(h)&&(c=g.parseCaps(c)),"object"===a.typeOf(c)){for(var y in c)if(!this.can(y,c[y],v))return!1;return!0}return"function"===a.typeOf(v[c])?v[c].call(this,h):h===v[c]},getShimContainer:function(){var h,g=c.get(this.shimid);return g||(h=this.options.container?c.get(this.options.container):document.body,g=document.createElement("div"),g.id=this.shimid,g.className="moxie-shim moxie-shim-"+this.type,a.extend(g.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),h.appendChild(g),h=null),g},getShim:function(){return _},shimExec:function(a,c){var h=[].slice.call(arguments,2);return b.getShim().exec.call(this,this.uid,a,c,h)},exec:function(a,c){var h=[].slice.call(arguments,2);return b[a]&&b[a][c]?b[a][c].apply(this,h):b.shimExec.apply(this,arguments)},destroy:function(){if(b){var a=c.get(this.shimid);a&&a.parentNode.removeChild(a),_&&_.removeAllInstances(),this.unbindAll(),delete y[this.uid],this.uid=null,T=b=_=a=null}}}),this.mode&&h.required_caps&&!this.can(h.required_caps)&&(this.mode=!1)}var v={},y={};return g.order="html5,flash,silverlight,html4",g.getRuntime=function(a){return y[a]?y[a]:!1},g.addConstructor=function(a,c){c.prototype=h.instance,v[a]=c},g.getConstructor=function(a){return v[a]||null},g.getInfo=function(a){var c=g.getRuntime(a);return c?{uid:c.uid,type:c.type,mode:c.mode,can:function(){return c.can.apply(c,arguments)}}:null},g.parseCaps=function(c){var h={};return"string"!==a.typeOf(c)?c||{}:(a.each(c.split(","),function(a){h[a]=!0}),h)},g.can=function(a,c){var h,v,y=g.getConstructor(a);return y?(h=new y({required_caps:c}),v=h.mode,h.destroy(),!!v):!1},g.thatCan=function(a,c){var h=(c||g.order).split(/\s*,\s*/);for(var i in h)if(g.can(h[i],a))return h[i];return null},g.getMode=function(c,h,g){var v=null;if("undefined"===a.typeOf(g)&&(g="browser"),h&&!a.isEmptyObj(c)){if(a.each(h,function(h,g){if(c.hasOwnProperty(g)){var y=c[g](h);if("string"==typeof y&&(y=[y]),v){if(!(v=a.arrayIntersect(v,y)))return v=!1}else v=y}}),v)return-1!==a.inArray(g,v)?g:v[0];if(v===!1)return!1}return g},g.capTrue=function(){return!0},g.capFalse=function(){return!1},g.capTest=function(a){return function(){return!!a}},g}),define("moxie/runtime/RuntimeClient",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(x,a,c){return function(){var h;a.extend(this,{connectRuntime:function(g){function v(a){var y,E;return a.length?(y=a.shift(),(E=c.getConstructor(y))?(h=new E(g),h.bind("Init",function(){h.initialized=!0,setTimeout(function(){h.clients++,w.trigger("RuntimeInit",h)},1)}),h.bind("Error",function(){h.destroy(),v(a)}),h.mode?void h.init():void h.trigger("Error")):void v(a)):(w.trigger("RuntimeError",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR)),void(h=null))}var y,w=this;if("string"===a.typeOf(g)?y=g:"string"===a.typeOf(g.ruid)&&(y=g.ruid),y){if(h=c.getRuntime(y))return h.clients++,h;throw new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR)}v((g.runtime_order||c.order).split(/\s*,\s*/))},getRuntime:function(){return h&&h.uid?h:(h=null,null)},disconnectRuntime:function(){h&&--h.clients<=0&&(h.destroy(),h=null)}})}}),define("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(a,c,h){function g(y,w){function E(c,h,y){var w,E=v[this.uid];return"string"===a.typeOf(E)&&E.length?(w=new g(null,{type:y,size:h-c}),w.detach(E.substr(c,w.size)),w):null}h.call(this),y&&this.connectRuntime(y),w?"string"===a.typeOf(w)&&(w={data:w}):w={},a.extend(this,{uid:w.uid||a.guid("uid_"),ruid:y,size:w.size||0,type:w.type||"",slice:function(a,c,h){return this.isDetached()?E.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),a,c,h)},getSource:function(){return v[this.uid]?v[this.uid]:null},detach:function(a){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy",v[this.uid]),this.disconnectRuntime(),this.ruid=null),a=a||"";var h=a.match(/^data:([^;]*);base64,/);h&&(this.type=h[1],a=c.atob(a.substring(a.indexOf("base64,")+7))),this.size=a.length,v[this.uid]=a},isDetached:function(){return!this.ruid&&"string"===a.typeOf(v[this.uid])},destroy:function(){this.detach(),delete v[this.uid]}}),w.data?this.detach(w.data):v[this.uid]=w}var v={};return g}),define("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(a,c,h){function g(g,v){var y,w;if(v||(v={}),w=v.type&&""!==v.type?v.type:c.getFileMime(v.name),v.name)y=v.name.replace(/\\/g,"/"),y=y.substr(y.lastIndexOf("/")+1);else{var E=w.split("/")[0];y=a.guid((""!==E?E:"file")+"_"),c.extensions[w]&&(y+="."+c.extensions[w][0])}h.apply(this,arguments),a.extend(this,{type:w||"",name:y||a.guid("file_"),lastModifiedDate:v.lastModifiedDate||(new Date).toLocaleString()})}return g.prototype=h.prototype,g}),define("moxie/file/FileInput",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/I18n","moxie/file/File","moxie/runtime/Runtime","moxie/runtime/RuntimeClient"],function(a,c,h,x,g,v,y,w,E){function R(g){var R,b,T,S=this;if(-1!==a.inArray(a.typeOf(g),["string","node"])&&(g={browse_button:g}),b=h.get(g.browse_button),!b)throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);T={accept:[{title:v.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:b.parentNode||document.body},g=a.extend({},T,g),"string"==typeof g.required_caps&&(g.required_caps=w.parseCaps(g.required_caps)),"string"==typeof g.accept&&(g.accept=c.mimes2extList(g.accept)),R=h.get(g.container),R||(R=document.body),"static"===h.getStyle(R,"position")&&(R.style.position="relative"),R=b=null,E.call(S),a.extend(S,{uid:a.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){S.convertEventPropsToHandlers(_),S.bind("RuntimeInit",function(e,c){S.ruid=c.uid,S.shimid=c.shimid,S.bind("Ready",function(){S.trigger("Refresh")},999),S.bind("Change",function(){var h=c.exec.call(S,"FileInput","getFiles");S.files=[],a.each(h,function(a){return 0===a.size?!0:void S.files.push(new y(S.ruid,a))})},999),S.bind("Refresh",function(){var v,y,w,E;w=h.get(g.browse_button),E=h.get(c.shimid),w&&(v=h.getPos(w,h.get(g.container)),y=h.getSize(w),E&&a.extend(E.style,{top:v.y+"px",left:v.x+"px",width:y.w+"px",height:y.h+"px"})),E=w=null}),c.exec.call(S,"FileInput","init",g)}),S.connectRuntime(a.extend({},g,{required_caps:{select_file:!0}}))},disable:function(c){var h=this.getRuntime();h&&h.exec.call(this,"FileInput","disable","undefined"===a.typeOf(c)?!0:c)},refresh:function(){S.trigger("Refresh")},destroy:function(){var c=this.getRuntime();c&&(c.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===a.typeOf(this.files)&&a.each(this.files,function(a){a.destroy()}),this.files=null}})}var _=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return R.prototype=g.instance,R}),define("moxie/file/FileDrop",["moxie/core/I18n","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/File","moxie/runtime/RuntimeClient","moxie/core/EventTarget","moxie/core/utils/Mime"],function(a,c,x,h,g,v,y,w){function E(y){var E,_=this;"string"==typeof y&&(y={drop_zone:y}),E={accept:[{title:a.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},y="object"==typeof y?h.extend({},E,y):E,y.container=c.get(y.drop_zone)||document.body,"static"===c.getStyle(y.container,"position")&&(y.container.style.position="relative"),"string"==typeof y.accept&&(y.accept=w.mimes2extList(y.accept)),v.call(_),h.extend(_,{uid:h.guid("uid_"),ruid:null,files:null,init:function(){_.convertEventPropsToHandlers(R),_.bind("RuntimeInit",function(e,a){_.ruid=a.uid,_.bind("Drop",function(){var c=a.exec.call(_,"FileDrop","getFiles");_.files=[],h.each(c,function(a){_.files.push(new g(_.ruid,a))})},999),a.exec.call(_,"FileDrop","init",y),_.dispatchEvent("ready")}),_.connectRuntime(y)},destroy:function(){var a=this.getRuntime();a&&(a.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null}})}var R=["ready","dragenter","dragleave","drop","error"];return E.prototype=y.instance,E}),define("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(a,c,h){function g(){this.uid=a.guid("uid_"),c.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return g.prototype=h.instance,g}),define("moxie/file/FileReader",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/Exceptions","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/runtime/RuntimeTarget"],function(a,c,x,h,g,v,y){function w(){function h(a,h){function _(a){R.readyState=w.DONE,R.error=a,R.trigger("error"),b()}function b(){v.destroy(),v=null,R.trigger("loadend")}function T(c){v.bind("Error",function(e,a){_(a)}),v.bind("Progress",function(e){R.result=c.exec.call(v,"FileReader","getResult"),R.trigger(e)}),v.bind("Load",function(e){R.readyState=w.DONE,R.result=c.exec.call(v,"FileReader","getResult"),R.trigger(e),b()}),c.exec.call(v,"FileReader","read",a,h)}if(v=new y,this.convertEventPropsToHandlers(E),this.readyState===w.LOADING)return _(new x.DOMException(x.DOMException.INVALID_STATE_ERR));if(this.readyState=w.LOADING,this.trigger("loadstart"),h instanceof g)if(h.isDetached()){var S=h.getSource();switch(a){case"readAsText":case"readAsBinaryString":this.result=S;break;case"readAsDataURL":this.result="data:"+h.type+";base64,"+c.btoa(S)}this.readyState=w.DONE,this.trigger("load"),b()}else T(v.connectRuntime(h.ruid));else _(new x.DOMException(x.DOMException.NOT_FOUND_ERR))}var v,R=this;a.extend(this,{uid:a.guid("uid_"),readyState:w.EMPTY,result:null,error:null,readAsBinaryString:function(a){h.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){h.call(this,"readAsDataURL",a)},readAsText:function(a){h.call(this,"readAsText",a)},abort:function(){this.result=null,-1===a.inArray(this.readyState,[w.EMPTY,w.DONE])&&(this.readyState===w.LOADING&&(this.readyState=w.DONE),v&&v.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),v&&(v.getRuntime().exec.call(this,"FileReader","destroy"),v.disconnectRuntime()),R=v=null}})}var E=["loadstart","progress","load","abort","error","loadend"];return w.EMPTY=0,w.LOADING=1,w.DONE=2,w.prototype=h.instance,w}),define("moxie/core/utils/Url",[],function(){var a=function(c,h){for(var g=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],i=g.length,ports={http:80,https:443},v={},y=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,m=y.exec(c||"");i--;)m[i]&&(v[g[i]]=m[i]);
if(!v.scheme){h&&"string"!=typeof h||(h=a(h||document.location.href)),v.scheme=h.scheme,v.host=h.host,v.port=h.port;var w="";/^[^\/]/.test(v.path)&&(w=h.path,/(\/|\/[^\.]+)$/.test(w)?w+="/":w=w.replace(/\/[^\/]+$/,"/")),v.path=w+(v.path||"")}return v.port||(v.port=ports[v.scheme]||80),v.port=parseInt(v.port,10),v.path||(v.path="/"),delete v.source,v},c=function(c){var ports={http:80,https:443},h=a(c);return h.scheme+"://"+h.host+(h.port!==ports[h.scheme]?":"+h.port:"")+h.path+(h.query?h.query:"")},h=function(c){function h(a){return[a.scheme,a.host,a.port].join("/")}return"string"==typeof c&&(c=a(c)),h(a())===h(c)};return{parseUrl:a,resolveUrl:c,hasSameOrigin:h}}),define("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(a,c,h){return function(){function g(a,c){if(!c.isDetached()){var g=this.connectRuntime(c.ruid).exec.call(this,"FileReaderSync","read",a,c);return this.disconnectRuntime(),g}var v=c.getSource();switch(a){case"readAsBinaryString":return v;case"readAsDataURL":return"data:"+c.type+";base64,"+h.btoa(v);case"readAsText":for(var y="",i=0,w=v.length;w>i;i++)y+=String.fromCharCode(v[i]);return y}}c.call(this),a.extend(this,{uid:a.guid("uid_"),readAsBinaryString:function(a){return g.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){return g.call(this,"readAsDataURL",a)},readAsText:function(a){return g.call(this,"readAsText",a)}})}}),define("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(x,a,c){function h(){var h,g=[];a.extend(this,{append:function(v,y){var w=this,E=a.typeOf(y);y instanceof c?h={name:v,value:y}:"array"===E?(v+="[]",a.each(y,function(a){w.append(v,a)})):"object"===E?a.each(y,function(a,c){w.append(v+"["+c+"]",a)}):"null"===E||"undefined"===E||"number"===E&&isNaN(y)?w.append(v,"false"):g.push({name:v,value:y.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return h&&h.value||null},getBlobName:function(){return h&&h.name||null},each:function(c){a.each(g,function(a){c(a.value,a.name)}),h&&c(h.value,h.name)},destroy:function(){h=null,g=[]}})}return h}),define("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(a,x,c,h,g,v,y,w,E,R,_,b){function T(){this.uid=a.guid("uid_")}function S(){function c(a,c){return k.hasOwnProperty(a)?1===arguments.length?_.can("define_property")?k[a]:P[a]:void(_.can("define_property")?k[a]=c:P[a]=c):void 0}function E(h){function g(){B.destroy(),B=null,E.dispatchEvent("loadend"),E=null}function w(v){B.bind("LoadStart",function(e){c("readyState",S.LOADING),E.dispatchEvent("readystatechange"),E.dispatchEvent(e),W&&E.upload.dispatchEvent(e)}),B.bind("Progress",function(e){c("readyState")!==S.LOADING&&(c("readyState",S.LOADING),E.dispatchEvent("readystatechange")),E.dispatchEvent(e)}),B.bind("UploadProgress",function(e){W&&E.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})}),B.bind("Load",function(e){c("readyState",S.DONE),c("status",Number(v.exec.call(B,"XMLHttpRequest","getStatus")||0)),c("statusText",A[c("status")]||""),c("response",v.exec.call(B,"XMLHttpRequest","getResponse",c("responseType"))),~a.inArray(c("responseType"),["text",""])?c("responseText",c("response")):"document"===c("responseType")&&c("responseXML",c("response")),et=v.exec.call(B,"XMLHttpRequest","getAllResponseHeaders"),E.dispatchEvent("readystatechange"),c("status")>0?(W&&E.upload.dispatchEvent(e),E.dispatchEvent(e)):($=!0,E.dispatchEvent("error")),g()}),B.bind("Abort",function(e){E.dispatchEvent(e),g()}),B.bind("Error",function(e){$=!0,c("readyState",S.DONE),E.dispatchEvent("readystatechange"),Y=!0,E.dispatchEvent(e),g()}),v.exec.call(B,"XMLHttpRequest","send",{url:D,method:N,async:U,user:L,password:M,headers:G,mimeType:X,encoding:z,responseType:E.responseType,withCredentials:E.withCredentials,options:Q},h)}var E=this;C=(new Date).getTime(),B=new y,"string"==typeof Q.required_caps&&(Q.required_caps=v.parseCaps(Q.required_caps)),Q.required_caps=a.extend({},Q.required_caps,{return_response_type:E.responseType}),h instanceof R&&(Q.required_caps.send_multipart=!0),J||(Q.required_caps.do_cors=!0),Q.ruid?w(B.connectRuntime(Q)):(B.bind("RuntimeInit",function(e,a){w(a)}),B.bind("RuntimeError",function(e,a){E.dispatchEvent("RuntimeError",a)}),B.connectRuntime(Q))}function I(){c("responseText",""),c("responseXML",null),c("response",null),c("status",0),c("statusText",""),C=F=null}var D,N,L,M,C,F,B,H,P=this,k={timeout:0,readyState:S.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},U=!0,G={},z=null,X=null,j=!1,V=!1,W=!1,Y=!1,$=!1,J=!1,Z=null,K=null,Q={},et="";a.extend(this,k,{uid:a.guid("uid_"),upload:new T,open:function(v,y,w,E,R){var _;if(!v||!y)throw new x.DOMException(x.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(v)||h.utf8_encode(v)!==v)throw new x.DOMException(x.DOMException.SYNTAX_ERR);if(~a.inArray(v.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(N=v.toUpperCase()),~a.inArray(N,["CONNECT","TRACE","TRACK"]))throw new x.DOMException(x.DOMException.SECURITY_ERR);if(y=h.utf8_encode(y),_=g.parseUrl(y),J=g.hasSameOrigin(_),D=g.resolveUrl(y),(E||R)&&!J)throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);if(L=E||_.user,M=R||_.pass,U=w||!0,U===!1&&(c("timeout")||c("withCredentials")||""!==c("responseType")))throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);j=!U,V=!1,G={},I.call(this),c("readyState",S.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange")},setRequestHeader:function(g,v){var y=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(c("readyState")!==S.OPENED||V)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(g)||h.utf8_encode(g)!==g)throw new x.DOMException(x.DOMException.SYNTAX_ERR);return g=a.trim(g).toLowerCase(),~a.inArray(g,y)||/^(proxy\-|sec\-)/.test(g)?!1:(G[g]?G[g]+=", "+v:G[g]=v,!0)},getAllResponseHeaders:function(){return et||""},getResponseHeader:function(c){return c=c.toLowerCase(),$||~a.inArray(c,["set-cookie","set-cookie2"])?null:et&&""!==et&&(H||(H={},a.each(et.split(/\r\n/),function(c){var h=c.split(/:\s+/);2===h.length&&(h[0]=a.trim(h[0]),H[h[0].toLowerCase()]={header:h[0],value:a.trim(h[1])})})),H.hasOwnProperty(c))?H[c].header+": "+H[c].value:null},overrideMimeType:function(h){var g,v;if(~a.inArray(c("readyState"),[S.LOADING,S.DONE]))throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(h=a.trim(h.toLowerCase()),/;/.test(h)&&(g=h.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(h=g[1],g[2]&&(v=g[2])),!b.mimes[h])throw new x.DOMException(x.DOMException.SYNTAX_ERR);Z=h,K=v},send:function(c,g){if(Q="string"===a.typeOf(g)?{ruid:g}:g?g:{},this.convertEventPropsToHandlers(O),this.upload.convertEventPropsToHandlers(O),this.readyState!==S.OPENED||V)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(c instanceof w)Q.ruid=c.ruid,X=c.type||"application/octet-stream";else if(c instanceof R){if(c.hasBlob()){var v=c.getBlob();Q.ruid=v.ruid,X=v.type||"application/octet-stream"}}else"string"==typeof c&&(z="UTF-8",X="text/plain;charset=UTF-8",c=h.utf8_encode(c));this.withCredentials||(this.withCredentials=Q.required_caps&&Q.required_caps.send_browser_cookies&&!J),W=!j&&this.upload.hasEventListener(),$=!1,Y=!c,j||(V=!0),E.call(this,c)},abort:function(){if($=!0,j=!1,~a.inArray(c("readyState"),[S.UNSENT,S.OPENED,S.DONE]))c("readyState",S.UNSENT);else{if(c("readyState",S.DONE),V=!1,!B)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);B.getRuntime().exec.call(B,"XMLHttpRequest","abort",Y),Y=!0}},destroy:function(){B&&("function"===a.typeOf(B.destroy)&&B.destroy(),B=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var A={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};T.prototype=c.instance;var O=["loadstart","progress","abort","error","load","timeout","loadend"];return S.UNSENT=0,S.OPENED=1,S.HEADERS_RECEIVED=2,S.LOADING=3,S.DONE=4,S.prototype=c.instance,S}),define("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(a,c,h,g){function v(){function g(){_=b=0,R=this.result=null}function y(c,h){var g=this;E=h,g.bind("TransportingProgress",function(e){b=e.loaded,_>b&&-1===a.inArray(g.state,[v.IDLE,v.DONE])&&w.call(g)},999),g.bind("TransportingComplete",function(){b=_,g.state=v.DONE,R=null,g.result=E.exec.call(g,"Transporter","getAsBlob",c||"")},999),g.state=v.BUSY,g.trigger("TransportingStarted"),w.call(g)}function w(){var a,h=this,g=_-b;T>g&&(T=g),a=c.btoa(R.substr(b,T)),E.exec.call(h,"Transporter","receive",a,_)}var mod,E,R,_,b,T;h.call(this),a.extend(this,{uid:a.guid("uid_"),state:v.IDLE,result:null,transport:function(c,h,v){var w=this;if(v=a.extend({chunk_size:204798},v),(mod=v.chunk_size%3)&&(v.chunk_size+=3-mod),T=v.chunk_size,g.call(this),R=c,_=c.length,"string"===a.typeOf(v)||v.ruid)y.call(w,h,this.connectRuntime(v));else{var E=function(e,a){w.unbind("RuntimeInit",E),y.call(w,h,a)};this.bind("RuntimeInit",E),this.connectRuntime(v)}},abort:function(){var a=this;a.state=v.IDLE,E&&(E.exec.call(a,"Transporter","clear"),a.trigger("TransportingAborted")),g.call(a)},destroy:function(){this.unbindAll(),E=null,this.disconnectRuntime(),g.call(this)}})}return v.IDLE=0,v.BUSY=1,v.DONE=2,v.prototype=g.instance,v}),define("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode"],function(a,c,x,h,g,v,y,w,E,R,_,b,T){function S(){function h(a){a||(a=this.getRuntime().exec.call(this,"Image","getInfo")),this.size=a.size,this.width=a.width,this.height=a.height,this.type=a.type,this.meta=a.meta,""===this.name&&(this.name=a.name)}function R(c){var h=a.typeOf(c);try{if(c instanceof S){if(!c.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);O.apply(this,arguments)}else if(c instanceof _){if(!~a.inArray(c.type,["image/jpeg","image/png"]))throw new x.ImageError(x.ImageError.WRONG_FORMAT);I.apply(this,arguments)}else if(-1!==a.inArray(h,["blob","file"]))R.call(this,new b(null,c),arguments[1]);else if("string"===h)/^data:[^;]*;base64,/.test(c)?R.call(this,new _(null,{data:c}),arguments[1]):D.apply(this,arguments);else{if("node"!==h||"img"!==c.nodeName.toLowerCase())throw new x.DOMException(x.DOMException.TYPE_MISMATCH_ERR);R.call(this,c.src,arguments[1])}}catch(ex){this.trigger("error",ex)}}function O(c,h){var g=this.connectRuntime(c.ruid);this.ruid=g.uid,g.exec.call(this,"Image","loadFromImage",c,"undefined"===a.typeOf(h)?!0:h)}function I(c,h){function g(a){y.ruid=a.uid,a.exec.call(y,"Image","loadFromBlob",c)}var y=this;y.name=c.name||"",c.isDetached()?(this.bind("RuntimeInit",function(e,a){g(a)}),h&&"string"==typeof h.required_caps&&(h.required_caps=v.parseCaps(h.required_caps)),this.connectRuntime(a.extend({required_caps:{access_image_binary:!0,resize_image:!0}},h))):g(this.connectRuntime(c.ruid))}function D(a,c){var h,v=this;h=new g,h.open("get",a),h.responseType="blob",h.onprogress=function(e){v.trigger(e)},h.onload=function(){I.call(v,h.response,!0)},h.onerror=function(e){v.trigger(e)},h.onloadend=function(){h.destroy()},h.bind("RuntimeError",function(e,a){v.trigger("RuntimeError",a)}),h.send(null,c)}y.call(this),a.extend(this,{uid:a.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){h.call(this)},999),this.convertEventPropsToHandlers(A),R.apply(this,arguments)},downsize:function(c,h,g,v){try{if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(this.width>S.MAX_RESIZE_WIDTH||this.height>S.MAX_RESIZE_HEIGHT)throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);(!c&&!h||"undefined"===a.typeOf(g))&&(g=!1),c=c||this.width,h=h||this.height,v="undefined"===a.typeOf(v)?!0:!!v,this.getRuntime().exec.call(this,"Image","downsize",c,h,g,v)}catch(ex){this.trigger("error",ex)}},crop:function(a,c,h){this.downsize(a,c,!0,h)},getAsCanvas:function(){if(!E.can("create_canvas"))throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);var a=this.connectRuntime(this.ruid);return a.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(a,c){if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);return a||(a="image/jpeg"),"image/jpeg"!==a||c||(c=90),this.getRuntime().exec.call(this,"Image","getAsBlob",a,c)},getAsDataURL:function(a,c){if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",a,c)},getAsBinaryString:function(a,c){var h=this.getAsDataURL(a,c);return T.atob(h.substring(h.indexOf("base64,")+7))},embed:function(h){function g(){if(E.can("create_canvas")){var c=v.getAsCanvas();if(c)return h.appendChild(c),c=null,v.destroy(),void A.trigger("embedded")}var g=v.getAsDataURL(y,R);if(!g)throw new x.ImageError(x.ImageError.WRONG_FORMAT);if(E.can("use_data_uri_of",g.length))h.innerHTML='<img src="'+g+'" width="'+v.width+'" height="'+v.height+'" />',v.destroy(),A.trigger("embedded");else{var _=new w;_.bind("TransportingComplete",function(){b=A.connectRuntime(this.result.ruid),A.bind("Embedded",function(){a.extend(b.getShimContainer().style,{top:"0px",left:"0px",width:v.width+"px",height:v.height+"px"}),b=null},999),b.exec.call(A,"ImageView","display",this.result.uid,I,D),v.destroy()}),_.transport(T.atob(g.substring(g.indexOf("base64,")+7)),y,a.extend({},O,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:h}))}}var v,y,R,_,b,A=this,O=arguments[1]||{},I=this.width,D=this.height;try{if(!(h=c.get(h)))throw new x.DOMException(x.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(this.width>S.MAX_RESIZE_WIDTH||this.height>S.MAX_RESIZE_HEIGHT)throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);if(y=O.type||this.type||"image/jpeg",R=O.quality||90,_="undefined"!==a.typeOf(O.crop)?O.crop:!1,O.width)I=O.width,D=O.height||I;else{var N=c.getSize(h);N.w&&N.h&&(I=N.w,D=N.h)}return v=new S,v.bind("Resize",function(){g.call(A)}),v.bind("Load",function(){v.downsize(I,D,_,!1)}),v.clone(this,!1),v}catch(ex){this.trigger("error",ex)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}})}var A=["progress","load","error","resize","embedded"];return S.MAX_RESIZE_WIDTH=6500,S.MAX_RESIZE_HEIGHT=6500,S.prototype=R.instance,S}),define("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(a,x,c,h){function g(g){var w=this,E=c.capTest,R=c.capTrue,_=a.extend({access_binary:E(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return w.can("access_binary")&&!!y.Image},display_media:E(h.can("create_canvas")||h.can("use_data_uri_over32kb")),do_cors:E(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:E(function(){var a=document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&("IE"!==h.browser||h.version>9)}()),filter_by_extension:E(function(){return"Chrome"===h.browser&&h.version>=28||"IE"===h.browser&&h.version>=10}()),return_response_headers:R,return_response_type:function(a){return"json"===a&&window.JSON?!0:h.can("return_response_type",a)},return_status_code:R,report_upload_progress:E(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return w.can("access_binary")&&h.can("create_canvas")},select_file:function(){return h.can("use_fileinput")&&window.File},select_folder:function(){return w.can("select_file")&&"Chrome"===h.browser&&h.version>=21},select_multiple:function(){return!(!w.can("select_file")||"Safari"===h.browser&&"Windows"===h.os||"iOS"===h.os&&h.verComp(h.osVersion,"7.0.4","<"))},send_binary_string:E(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:E(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||w.can("send_binary_string")},slice_blob:E(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return w.can("slice_blob")&&w.can("send_multipart")},summon_file_dialog:E(function(){return"Firefox"===h.browser&&h.version>=4||"Opera"===h.browser&&h.version>=12||"IE"===h.browser&&h.version>=10||!!~a.inArray(h.browser,["Chrome","Safari"])}()),upload_filesize:R},arguments[2]);c.call(this,g,arguments[1]||v,_),a.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(w),a=w=null}}(this.destroy)}),a.extend(this.getShim(),y)}var v="html5",y={};return c.addConstructor(v,g),y}),define("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(a,c){function h(){function a(a,c,h){var g;if(!window.File.prototype.slice)return(g=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?g.call(a,c,h):null;try{return a.slice(),a.slice(c,h)}catch(e){return a.slice(c,h-c)}}this.slice=function(){return new c(this.getRuntime().uid,a.apply(this,arguments))}}return a.Blob=h}),define("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(a){function c(){this.returnValue=!1}function h(){this.cancelBubble=!0}var g={},v="moxie_"+a.guid(),y=function(y,w,E,R){var _,b;w=w.toLowerCase(),y.addEventListener?(_=E,y.addEventListener(w,_,!1)):y.attachEvent&&(_=function(){var a=window.event;a.target||(a.target=a.srcElement),a.preventDefault=c,a.stopPropagation=h,E(a)},y.attachEvent("on"+w,_)),y[v]||(y[v]=a.guid()),g.hasOwnProperty(y[v])||(g[y[v]]={}),b=g[y[v]],b.hasOwnProperty(w)||(b[w]=[]),b[w].push({func:_,orig:E,key:R})},w=function(c,h,y){var w,E;if(h=h.toLowerCase(),c[v]&&g[c[v]]&&g[c[v]][h]){w=g[c[v]][h];for(var i=w.length-1;i>=0&&(w[i].orig!==y&&w[i].key!==y||(c.removeEventListener?c.removeEventListener(h,w[i].func,!1):c.detachEvent&&c.detachEvent("on"+h,w[i].func),w[i].orig=null,w[i].func=null,w.splice(i,1),y===E));i--);if(w.length||delete g[c[v]][h],a.isEmptyObj(g[c[v]])){delete g[c[v]];try{delete c[v]}catch(e){c[v]=E}}}},E=function(c,h){c&&c[v]&&a.each(g[c[v]],function(a,g){w(c,g,h)})};return{addEvent:y,removeEvent:w,removeAllEvents:E}}),define("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(a,c,h,g,v,y){function w(){var a,w=[];c.extend(this,{init:function(E){var R,_,b,T,S,A,O=this,I=O.getRuntime();a=E,w=[],b=a.accept.mimes||v.extList2mimes(a.accept,I.can("filter_by_extension")),_=I.getShimContainer(),_.innerHTML='<input id="'+I.uid+'" type="file" style="font-size:999px;opacity:0;"'+(a.multiple&&I.can("select_multiple")?"multiple":"")+(a.directory&&I.can("select_folder")?"webkitdirectory directory":"")+(b?' accept="'+b.join(",")+'"':"")+" />",R=h.get(I.uid),c.extend(R.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),T=h.get(a.browse_button),I.can("summon_file_dialog")&&("static"===h.getStyle(T,"position")&&(T.style.position="relative"),S=parseInt(h.getStyle(T,"z-index"),10)||1,T.style.zIndex=S,_.style.zIndex=S-1,g.addEvent(T,"click",function(e){var a=h.get(I.uid);a&&!a.disabled&&a.click(),e.preventDefault()},O.uid)),A=I.can("summon_file_dialog")?T:_,g.addEvent(A,"mouseover",function(){O.trigger("mouseenter")},O.uid),g.addEvent(A,"mouseout",function(){O.trigger("mouseleave")},O.uid),g.addEvent(A,"mousedown",function(){O.trigger("mousedown")},O.uid),g.addEvent(h.get(a.container),"mouseup",function(){O.trigger("mouseup")},O.uid),R.onchange=function D(){if(w=[],a.directory?c.each(this.files,function(a){"."!==a.name&&w.push(a)}):w=[].slice.call(this.files),"IE"!==y.browser)this.value="";else{var h=this.cloneNode(!0);this.parentNode.replaceChild(h,this),h.onchange=D}O.trigger("change")},O.trigger({type:"ready",async:!0}),_=null},getFiles:function(){return w},disable:function(a){var c,g=this.getRuntime();(c=h.get(g.uid))&&(c.disabled=!!a)},destroy:function(){var c=this.getRuntime(),v=c.getShim(),y=c.getShimContainer();g.removeAllEvents(y,this.uid),g.removeAllEvents(a&&h.get(a.container),this.uid),g.removeAllEvents(a&&h.get(a.browse_button),this.uid),y&&(y.innerHTML=""),v.removeInstance(this.uid),w=a=y=v=null}})}return a.FileInput=w}),define("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(a,c,h,g,v){function y(){function a(a){for(var h=[],i=0;i<a.length;i++)[].push.apply(h,a[i].extensions.split(/\s*,\s*/));return-1===c.inArray("*",h)?h:[]}function y(a){var h=v.getFileExtension(a.name);return!h||!S.length||-1!==c.inArray(h,S)}function w(a,h){var g=[];c.each(a,function(a){var c=a.webkitGetAsEntry();if(c)if(c.isFile){var h=a.getAsFile();y(h)&&T.push(h)}else g.push(c)}),g.length?E(g,h):h()}function E(a,h){var g=[];c.each(a,function(a){g.push(function(c){R(a,c)})}),c.inSeries(g,function(){h()})}function R(a,c){a.isFile?a.file(function(a){y(a)&&T.push(a),c()},function(){c()}):a.isDirectory?_(a,c):c()}function _(a,c){function h(a){v.readEntries(function(c){c.length?([].push.apply(g,c),h(a)):a()},a)}var g=[],v=a.createReader();h(function(){E(g,c)})}var b,T=[],S=[];c.extend(this,{init:function(h){var v,E=this;b=h,S=a(b.accept),v=b.container,g.addEvent(v,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},E.uid),g.addEvent(v,"drop",function(e){e.preventDefault(),e.stopPropagation(),T=[],e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry?w(e.dataTransfer.items,function(){E.trigger("drop")}):(c.each(e.dataTransfer.files,function(a){y(a)&&T.push(a)}),E.trigger("drop"))},E.uid),g.addEvent(v,"dragenter",function(e){e.preventDefault(),e.stopPropagation(),E.trigger("dragenter")},E.uid),g.addEvent(v,"dragleave",function(e){e.preventDefault(),e.stopPropagation(),E.trigger("dragleave")},E.uid)},getFiles:function(){return T},destroy:function(){g.removeAllEvents(b&&h.get(b.container),this.uid),T=S=b=null}})}return a.FileDrop=y}),define("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(a,c,h){function g(){function a(a){return c.atob(a.substring(a.indexOf("base64,")+7))}var g,v=!1;h.extend(this,{read:function(a,c){var y=this;g=new window.FileReader,g.addEventListener("progress",function(e){y.trigger(e)}),g.addEventListener("load",function(e){y.trigger(e)}),g.addEventListener("error",function(e){y.trigger(e,g.error)}),g.addEventListener("loadend",function(){g=null}),"function"===h.typeOf(g[a])?(v=!1,g[a](c.getSource())):"readAsBinaryString"===a&&(v=!0,g.readAsDataURL(c.getSource()))},getResult:function(){return g&&g.result?v?a(g.result):g.result:null},abort:function(){g&&g.abort()},destroy:function(){g=null}})}return a.FileReader=g}),define("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(a,c,h,g,v,y,w,x,E){function R(){function a(a,c){var h,g,v=this;h=c.getBlob().getSource(),g=new window.FileReader,g.onload=function(){c.append(c.getBlobName(),new y(null,{type:h.type,data:g.result})),A.send.call(v,a,c)},g.readAsBinaryString(h)}function R(){return!window.XMLHttpRequest||"IE"===E.browser&&E.version<8?function(){for(var a=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],i=0;i<a.length;i++)try{return new ActiveXObject(a[i])}catch(ex){}}():new window.XMLHttpRequest}function _(a){var c=a.responseXML,h=a.responseText;return"IE"===E.browser&&h&&c&&!c.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(a.getResponseHeader("Content-Type"))&&(c=new window.ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.validateOnParse=!1,c.loadXML(h)),c&&("IE"===E.browser&&0!==c.parseError||!c.documentElement||"parsererror"===c.documentElement.tagName)?null:c}function b(a){var c="----moxieboundary"+(new Date).getTime(),h="--",g="\r\n",v="",w=this.getRuntime();if(!w.can("send_binary_string"))throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);return T.setRequestHeader("Content-Type","multipart/form-data; boundary="+c),a.each(function(a,w){v+=a instanceof y?h+c+g+'Content-Disposition: form-data; name="'+w+'"; filename="'+unescape(encodeURIComponent(a.name||"blob"))+'"'+g+"Content-Type: "+(a.type||"application/octet-stream")+g+g+a.getSource()+g:h+c+g+'Content-Disposition: form-data; name="'+w+'"'+g+g+unescape(encodeURIComponent(a))+g}),v+=h+c+h+g}var T,S,A=this;c.extend(this,{send:function(h,v){var _=this,A="Mozilla"===E.browser&&E.version>=4&&E.version<7,O="Android Browser"===E.browser,I=!1;if(S=h.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),T=R(),T.open(h.method,h.url,h.async,h.user,h.password),v instanceof y)v.isDetached()&&(I=!0),v=v.getSource();else if(v instanceof w){if(v.hasBlob())if(v.getBlob().isDetached())v=b.call(_,v),I=!0;else if((A||O)&&"blob"===c.typeOf(v.getBlob().getSource())&&window.FileReader)return void a.call(_,h,v);if(v instanceof w){var D=new window.FormData;v.each(function(a,c){a instanceof y?D.append(c,a.getSource()):D.append(c,a)}),v=D}}T.upload?(h.withCredentials&&(T.withCredentials=!0),T.addEventListener("load",function(e){_.trigger(e)}),T.addEventListener("error",function(e){_.trigger(e)}),T.addEventListener("progress",function(e){_.trigger(e)}),T.upload.addEventListener("progress",function(e){_.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})})):T.onreadystatechange=function(){switch(T.readyState){case 1:break;case 2:break;case 3:var a,c;try{g.hasSameOrigin(h.url)&&(a=T.getResponseHeader("Content-Length")||0),T.responseText&&(c=T.responseText.length)}catch(ex){a=c=0}_.trigger({type:"progress",lengthComputable:!!a,total:parseInt(a,10),loaded:c});break;case 4:T.onreadystatechange=function(){},_.trigger(0===T.status?"error":"load")}},c.isEmptyObj(h.headers)||c.each(h.headers,function(a,c){T.setRequestHeader(c,a)}),""!==h.responseType&&"responseType"in T&&(T.responseType="json"!==h.responseType||E.can("return_response_type","json")?h.responseType:"text"),I?T.sendAsBinary?T.sendAsBinary(v):!function(){for(var a=new Uint8Array(v.length),i=0;i<v.length;i++)a[i]=255&v.charCodeAt(i);T.send(a.buffer)}():T.send(v),_.trigger("loadstart")},getStatus:function(){try{if(T)return T.status}catch(ex){}return 0},getResponse:function(a){var c=this.getRuntime();try{switch(a){case"blob":var g=new v(c.uid,T.response),y=T.getResponseHeader("Content-Disposition");if(y){var w=y.match(/filename=([\'\"'])([^\1]+)\1/);w&&(S=w[2])}return g.name=S,g.type||(g.type=h.getFileMime(S)),g;case"json":return E.can("return_response_type","json")?T.response:200===T.status&&window.JSON?JSON.parse(T.responseText):null;case"document":return _(T);default:return""!==T.responseText?T.responseText:null}}catch(ex){return null}},getAllResponseHeaders:function(){try{return T.getAllResponseHeaders()}catch(ex){}return""},abort:function(){T&&T.abort()},destroy:function(){A=S=null}})}return a.XMLHttpRequest=R}),define("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){function c(a,c){var i,h=y?0:-8*(c-1),g=0;for(i=0;c>i;i++)g|=v.charCodeAt(a+i)<<Math.abs(h+8*i);return g}function h(a,c,h){h=3===arguments.length?h:v.length-c-1,v=v.substr(0,c)+a+v.substr(h+c)}function g(a,c,g){var i,v="",w=y?0:-8*(g-1);for(i=0;g>i;i++)v+=String.fromCharCode(c>>Math.abs(w+8*i)&255);h(v,a,g)}var v,y=!1;return{II:function(c){return c===a?y:void(y=c)},init:function(a){y=!1,v=a},SEGMENT:function(a,c,g){switch(arguments.length){case 1:return v.substr(a,v.length-a-1);case 2:return v.substr(a,c);case 3:h(g,a,c);break;default:return v}},BYTE:function(a){return c(a,1)},SHORT:function(a){return c(a,2)},LONG:function(h,v){return v===a?c(h,4):void g(h,v,4)},SLONG:function(a){var h=c(a,4);return h>2147483647?h-4294967296:h},STRING:function(a,h){var g="";for(h+=a;h>a;a++)g+=String.fromCharCode(c(a,1));return g}}}}),define("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],function(a){return function c(h){var g,v,y,w=[],E=0;if(g=new a,g.init(h),65496===g.SHORT(0)){for(v=2;v<=h.length;)if(y=g.SHORT(v),y>=65488&&65495>=y)v+=2;else{if(65498===y||65497===y)break;E=g.SHORT(v+2)+2,y>=65505&&65519>=y&&w.push({hex:y,name:"APP"+(15&y),start:v,length:E,segment:g.SEGMENT(v,E)}),v+=E}return g.init(null),{headers:w,restore:function(a){var c,i;for(g.init(a),v=65504==g.SHORT(2)?4+g.SHORT(4):2,i=0,c=w.length;c>i;i++)g.SEGMENT(v,0,w[i].segment),v+=w[i].length;return a=g.SEGMENT(),g.init(null),a},strip:function(a){var h,v,i;for(v=new c(a),h=v.headers,v.purge(),g.init(a),i=h.length;i--;)g.SEGMENT(h[i].start,h[i].length,"");return a=g.SEGMENT(),g.init(null),a},get:function(a){for(var c=[],i=0,h=w.length;h>i;i++)w[i].name===a.toUpperCase()&&c.push(w[i].segment);return c},set:function(a,c){var i,h,g,v=[];for("string"==typeof c?v.push(c):v=c,i=h=0,g=w.length;g>i&&(w[i].name===a.toUpperCase()&&(w[i].segment=v[h],w[i].length=v[h].length,h++),!(h>=v.length));i++);},purge:function(){w=[],g.init(null),g=null}}}}}),define("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(c,h){return function(){function g(c,h){var i,g,v,y,E,R,T,S,A=w.SHORT(c),O=[],I={};for(i=0;A>i;i++)if(T=R=c+12*i+2,v=h[w.SHORT(T)],v!==a){switch(y=w.SHORT(T+=2),E=w.LONG(T+=2),T+=4,O=[],y){case 1:case 7:for(E>4&&(T=w.LONG(T)+b.tiffHeader),g=0;E>g;g++)O[g]=w.BYTE(T+g);break;case 2:E>4&&(T=w.LONG(T)+b.tiffHeader),I[v]=w.STRING(T,E-1);continue;case 3:for(E>2&&(T=w.LONG(T)+b.tiffHeader),g=0;E>g;g++)O[g]=w.SHORT(T+2*g);break;case 4:for(E>1&&(T=w.LONG(T)+b.tiffHeader),g=0;E>g;g++)O[g]=w.LONG(T+4*g);break;case 5:for(T=w.LONG(T)+b.tiffHeader,g=0;E>g;g++)O[g]=w.LONG(T+4*g)/w.LONG(T+4*g+4);break;case 9:for(T=w.LONG(T)+b.tiffHeader,g=0;E>g;g++)O[g]=w.SLONG(T+4*g);break;case 10:for(T=w.LONG(T)+b.tiffHeader,g=0;E>g;g++)O[g]=w.SLONG(T+4*g)/w.SLONG(T+4*g+4);
break;default:continue}S=1==E?O[0]:O,I[v]=_.hasOwnProperty(v)&&"object"!=typeof S?_[v][S]:S}return I}function v(){var a=b.tiffHeader;return w.II(18761==w.SHORT(a)),42!==w.SHORT(a+=2)?!1:(b.IFD0=b.tiffHeader+w.LONG(a+=2),R=g(b.IFD0,E.tiff),"ExifIFDPointer"in R&&(b.exifIFD=b.tiffHeader+R.ExifIFDPointer,delete R.ExifIFDPointer),"GPSInfoIFDPointer"in R&&(b.gpsIFD=b.tiffHeader+R.GPSInfoIFDPointer,delete R.GPSInfoIFDPointer),!0)}function y(a,c,h){var g,v,y,R=0;if("string"==typeof c){var _=E[a.toLowerCase()];for(var T in _)if(_[T]===c){c=T;break}}g=b[a.toLowerCase()+"IFD"],v=w.SHORT(g);for(var i=0;v>i;i++)if(y=g+12*i+2,w.SHORT(y)==c){R=y+8;break}return R?(w.LONG(R,h),!0):!1}var w,E,R,_,b={};return w=new h,E={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},_={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(c){return b={tiffHeader:10},c!==a&&c.length?(w.init(c),65505===w.SHORT(0)&&"EXIF\x00"===w.STRING(4,5).toUpperCase()?v():!1):!1},TIFF:function(){return R},EXIF:function(){var a;if(a=g(b.exifIFD,E.exif),a.ExifVersion&&"array"===c.typeOf(a.ExifVersion)){for(var i=0,h="";i<a.ExifVersion.length;i++)h+=String.fromCharCode(a.ExifVersion[i]);a.ExifVersion=h}return a},GPS:function(){var a;return a=g(b.gpsIFD,E.gps),a.GPSVersionID&&"array"===c.typeOf(a.GPSVersionID)&&(a.GPSVersionID=a.GPSVersionID.join(".")),a},setExif:function(a,c){return"PixelXDimension"!==a&&"PixelYDimension"!==a?!1:y("exif",a,c)},getBinary:function(){return w.SEGMENT()},purge:function(){w.init(null),w=R=null,b={}}}}}),define("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(a,x,c,h,g){function v(v){function y(){for(var a,c,h=0;h<=E.length;){if(a=R.SHORT(h+=2),a>=65472&&65475>=a)return h+=5,{height:R.SHORT(h),width:R.SHORT(h+=2)};c=R.SHORT(h+=2),h+=c-2}return null}function w(){b&&_&&R&&(b.purge(),_.purge(),R.init(null),E=T=_=b=R=null)}var E,R,_,b,T,S;if(E=v,R=new h,R.init(E),65496!==R.SHORT(0))throw new x.ImageError(x.ImageError.WRONG_FORMAT);_=new c(v),b=new g,S=!!b.init(_.get("app1")[0]),T=y.call(this),a.extend(this,{type:"image/jpeg",size:E.length,width:T&&T.width||0,height:T&&T.height||0,setExif:function(c,h){return S?("object"===a.typeOf(c)?a.each(c,function(a,c){b.setExif(c,a)}):b.setExif(c,h),void _.set("app1",b.getBinary())):!1},writeHeaders:function(){return arguments.length?_.restore(arguments[0]):E=_.restore(E)},stripHeaders:function(a){return _.strip(a)},purge:function(){w.call(this)}}),S&&(this.meta={tiff:b.TIFF(),exif:b.EXIF(),gps:b.GPS()})}return v}),define("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(x,a,c){function h(h){function g(){var a,c;return a=y.call(this,8),"IHDR"==a.type?(c=a.start,{width:E.LONG(c),height:E.LONG(c+=4)}):null}function v(){E&&(E.init(null),w=b=R=_=E=null)}function y(a){var c,h,g,v;return c=E.LONG(a),h=E.STRING(a+=4,4),g=a+=4,v=E.LONG(a+c),{length:c,type:h,start:g,CRC:v}}var w,E,R,_,b;w=h,E=new c,E.init(w),function(){var a=0,i=0,c=[35152,20039,3338,6666];for(i=0;i<c.length;i++,a+=2)if(c[i]!=E.SHORT(a))throw new x.ImageError(x.ImageError.WRONG_FORMAT)}(),b=g.call(this),a.extend(this,{type:"image/png",size:w.length,width:b.width,height:b.height,purge:function(){v.call(this)}}),v.call(this)}return h}),define("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(a,x,c,h){return function(g){var v,y=[c,h];v=function(){for(var i=0;i<y.length;i++)try{return new y[i](g)}catch(ex){}throw new x.ImageError(x.ImageError.WRONG_FORMAT)}(),a.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(a){return a},stripHeaders:function(a){return a},purge:function(){}}),a.extend(this,v),this.purge=function(){v.purge(),v=null}}}),define("moxie/runtime/html5/image/MegaPixel",[],function(){function a(a,g,v){var y=a.naturalWidth,w=a.naturalHeight,E=v.width,R=v.height,x=v.x||0,_=v.y||0,b=g.getContext("2d");c(a)&&(y/=2,w/=2);var d=1024,T=document.createElement("canvas");T.width=T.height=d;for(var S=T.getContext("2d"),A=h(a,y,w),O=0;w>O;){for(var I=O+d>w?w-O:d,D=0;y>D;){var N=D+d>y?y-D:d;S.clearRect(0,0,d,d),S.drawImage(a,-D,-O);var L=D*E/y+x<<0,M=Math.ceil(N*E/y),C=O*R/w/A+_<<0,F=Math.ceil(I*R/w/A);b.drawImage(T,0,0,N,I,L,C,M,F),D+=d}O+=d}T=S=null}function c(a){var c=a.naturalWidth,h=a.naturalHeight;if(c*h>1048576){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");return v.drawImage(a,-c+1,0),0===v.getImageData(0,0,1,1).data[3]}return!1}function h(a,c,h){var g=document.createElement("canvas");g.width=1,g.height=h;var v=g.getContext("2d");v.drawImage(a,0,0);for(var y=v.getImageData(0,0,1,h).data,w=0,E=h,R=h;R>w;){var _=y[4*(R-1)+3];0===_?E=R:w=R,R=E+w>>1}g=null;var b=R/h;return 0===b?1:b}return{isSubsampled:c,renderTo:a}}),define("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/File","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/MegaPixel","moxie/core/utils/Mime","moxie/core/utils/Env"],function(a,c,x,h,g,v,y,w,E){function R(){function a(){if(!L&&!D)throw new x.ImageError(x.DOMException.INVALID_STATE_ERR);return L||D}function R(a){return h.atob(a.substring(a.indexOf("base64,")+7))}function _(a,c){return"data:"+(c||"")+";base64,"+h.btoa(a)}function b(a){var c=this;D=new Image,D.onerror=function(){I.call(this),c.trigger("error",new x.ImageError(x.ImageError.WRONG_FORMAT))},D.onload=function(){c.trigger("load")},D.src=/^data:[^;]*;base64,/.test(a)?a:_(a,C.type)}function T(a,c){var h,g=this;return window.FileReader?(h=new FileReader,h.onload=function(){c(this.result)},h.onerror=function(){g.trigger("error",new x.FileException(x.FileException.NOT_READABLE_ERR))},h.readAsDataURL(a),void 0):c(a.getAsDataURL())}function S(h,g,v,y){var w,E,R,_,b,T,S=this,x=0,I=0;if(H=y,T=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==c.inArray(T,[5,6,7,8])){var D=h;h=g,g=D}return R=a(),E=v?Math.max:Math.min,w=E(h/R.width,g/R.height),w>1&&(!v||y)?void this.trigger("Resize"):(L||(L=document.createElement("canvas")),_=Math.round(R.width*w),b=Math.round(R.height*w),v?(L.width=h,L.height=g,_>h&&(x=Math.round((_-h)/2)),b>g&&(I=Math.round((b-g)/2))):(L.width=_,L.height=b),H||O(L.width,L.height,T),A.call(this,R,L,-x,-I,_,b),this.width=L.width,this.height=L.height,B=!0,void S.trigger("Resize"))}function A(a,c,x,h,g,v){if("iOS"===E.OS)y.renderTo(a,c,{width:g,height:v,x:x,y:h});else{var w=c.getContext("2d");w.drawImage(a,x,h,g,v)}}function O(a,c,h){switch(h){case 5:case 6:case 7:case 8:L.width=c,L.height=a;break;default:L.width=a,L.height=c}var g=L.getContext("2d");switch(h){case 2:g.translate(a,0),g.scale(-1,1);break;case 3:g.translate(a,c),g.rotate(Math.PI);break;case 4:g.translate(0,c),g.scale(1,-1);break;case 5:g.rotate(.5*Math.PI),g.scale(1,-1);break;case 6:g.rotate(.5*Math.PI),g.translate(0,-c);break;case 7:g.rotate(.5*Math.PI),g.translate(a,-c),g.scale(-1,1);break;case 8:g.rotate(-.5*Math.PI),g.translate(-a,0)}}function I(){N&&(N.purge(),N=null),M=D=L=C=null,B=!1}var D,N,L,M,C,F=this,B=!1,H=!0;c.extend(this,{loadFromBlob:function(a){var c=this,h=c.getRuntime(),g=arguments.length>1?arguments[1]:!0;if(!h.can("access_binary"))throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);return C=a,a.isDetached()?(M=a.getSource(),void b.call(this,M)):void T.call(this,a.getSource(),function(a){g&&(M=R(a)),b.call(c,a)})},loadFromImage:function(a,c){this.meta=a.meta,C=new g(null,{name:a.name,size:a.size,type:a.type}),b.call(this,c?M=a.getAsBinaryString():a.getAsDataURL())},getInfo:function(){var c,h=this.getRuntime();return!N&&M&&h.can("access_image_binary")&&(N=new v(M)),c={width:a().width||0,height:a().height||0,type:C.type||w.getFileMime(C.name),size:M&&M.length||C.size||0,name:C.name||"",meta:N&&N.meta||this.meta||{}}},downsize:function(){S.apply(this,arguments)},getAsCanvas:function(){return L&&(L.id=this.uid+"_canvas"),L},getAsBlob:function(a,c){return a!==this.type&&S.call(this,this.width,this.height,!1),new g(null,{name:C.name||"",type:a,data:F.getAsBinaryString.call(this,a,c)})},getAsDataURL:function(a){var c=arguments[1]||90;if(!B)return D.src;if("image/jpeg"!==a)return L.toDataURL("image/png");try{return L.toDataURL("image/jpeg",c/100)}catch(ex){return L.toDataURL("image/jpeg")}},getAsBinaryString:function(a,c){if(!B)return M||(M=R(F.getAsDataURL(a,c))),M;if("image/jpeg"!==a)M=R(F.getAsDataURL(a,c));else{var h;c||(c=90);try{h=L.toDataURL("image/jpeg",c/100)}catch(ex){h=L.toDataURL("image/jpeg")}M=R(h),N&&(M=N.stripHeaders(M),H&&(N.meta&&N.meta.exif&&N.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),M=N.writeHeaders(M)),N.purge(),N=null)}return B=!1,M},destroy:function(){F=null,I.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return a.Image=R}),define("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(a,c,h,x,g){function v(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(c){try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(h){a="0.0"}}return a=a.match(/\d+/g),parseFloat(a[0]+"."+a[1])}function y(y){var R,_=this;y=a.extend({swf_url:c.swf_url},y),g.call(this,y,w,{access_binary:function(a){return a&&"browser"===_.mode},access_image_binary:function(a){return a&&"browser"===_.mode},display_media:g.capTrue,do_cors:g.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===_.mode},resize_image:g.capTrue,return_response_headers:!1,return_response_type:function(c){return"json"===c&&window.JSON?!0:!a.arrayDiff(c,["","text","document"])||"browser"===_.mode},return_status_code:function(c){return"browser"===_.mode||!a.arrayDiff(c,[200,404])},select_file:g.capTrue,select_multiple:g.capTrue,send_binary_string:function(a){return a&&"browser"===_.mode},send_browser_cookies:function(a){return a&&"browser"===_.mode},send_custom_headers:function(a){return a&&"browser"===_.mode},send_multipart:g.capTrue,slice_blob:g.capTrue,stream_upload:function(a){return a&&"browser"===_.mode},summon_file_dialog:!1,upload_filesize:function(c){return a.parseSizeStr(c)<=2097152||"client"===_.mode},use_http_method:function(c){return!a.arrayDiff(c,["GET","POST"])}},{access_binary:function(a){return a?"browser":"client"},access_image_binary:function(a){return a?"browser":"client"},report_upload_progress:function(a){return a?"browser":"client"},return_response_type:function(c){return a.arrayDiff(c,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(c){return a.arrayDiff(c,[200,404])?"browser":["client","browser"]},send_binary_string:function(a){return a?"browser":"client"},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"browser":"client"},stream_upload:function(a){return a?"client":"browser"},upload_filesize:function(c){return a.parseSizeStr(c)>=2097152?"client":"browser"}},"client"),v()<10&&(this.mode=!1),a.extend(this,{getShim:function(){return h.get(this.uid)},shimExec:function(a,c){var h=[].slice.call(arguments,2);return _.getShim().exec(this.uid,a,c,h)},init:function(){var h,g,v;v=this.getShimContainer(),a.extend(v.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),h='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+y.swf_url+'" ',"IE"===c.browser&&(h+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),h+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+y.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+c.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===c.browser?(g=document.createElement("div"),v.appendChild(g),g.outerHTML=h,g=v=null):v.innerHTML=h,R=setTimeout(function(){_&&!_.initialized&&_.trigger("Error",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(a){return function(){a.call(_),clearTimeout(R),y=R=a=_=null}}(this.destroy)},E)}var w="flash",E={};return g.addConstructor(w,y),E}),define("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(a,c){var h={slice:function(a,h,g,v){var y=this.getRuntime();return 0>h?h=Math.max(a.size+h,0):h>0&&(h=Math.min(h,a.size)),0>g?g=Math.max(a.size+g,0):g>0&&(g=Math.min(g,a.size)),a=y.shimExec.call(this,"Blob","slice",h,g,v||""),a&&(a=new c(y.uid,a)),a}};return a.Blob=h}),define("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime"],function(a){var c={init:function(a){this.getRuntime().shimExec.call(this,"FileInput","init",{name:a.name,accept:a.accept,multiple:a.multiple}),this.trigger("ready")}};return a.FileInput=c}),define("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(a,c){function h(a,h){switch(h){case"readAsText":return c.atob(a,"utf8");case"readAsBinaryString":return c.atob(a);case"readAsDataURL":return a}return null}var g="",v={read:function(a,c){var v=this,y=v.getRuntime();return"readAsDataURL"===a&&(g="data:"+(c.type||"")+";base64,"),v.bind("Progress",function(e,c){c&&(g+=h(c,a))}),y.shimExec.call(this,"FileReader","readAsBase64",c.uid)},getResult:function(){return g},destroy:function(){g=null}};return a.FileReader=v}),define("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(a,c){function h(a,h){switch(h){case"readAsText":return c.atob(a,"utf8");case"readAsBinaryString":return c.atob(a);case"readAsDataURL":return a}return null}var g={read:function(a,c){var g,v=this.getRuntime();return(g=v.shimExec.call(this,"FileReaderSync","readAsBase64",c.uid))?("readAsDataURL"===a&&(g="data:"+(c.type||"")+";base64,"+g),h(g,a,c.type)):null}};return a.FileReaderSync=g}),define("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter"],function(a,c,h,g,v,y,w){var E={send:function(a,g){function v(){a.transport=b.mode,b.shimExec.call(_,"XMLHttpRequest","send",a,g)}function E(a,c){b.shimExec.call(_,"XMLHttpRequest","appendBlob",a,c.uid),g=null,v()}function R(a,c){var h=new w;h.bind("TransportingComplete",function(){c(this.result)}),h.transport(a.getSource(),a.type,{ruid:b.uid})}var _=this,b=_.getRuntime();if(c.isEmptyObj(a.headers)||c.each(a.headers,function(a,c){b.shimExec.call(_,"XMLHttpRequest","setRequestHeader",c,a.toString())}),g instanceof y){var T;if(g.each(function(a,c){a instanceof h?T=c:b.shimExec.call(_,"XMLHttpRequest","append",c,a)}),g.hasBlob()){var S=g.getBlob();S.isDetached()?R(S,function(a){S.destroy(),E(T,a)}):E(T,S)}else g=null,v()}else g instanceof h?g.isDetached()?R(g,function(a){g.destroy(),g=a.uid,v()}):(g=g.uid,v()):v()},getResponse:function(a){var h,y,w=this.getRuntime();if(y=w.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(y=new g(w.uid,y),"blob"===a)return y;try{if(h=new v,~c.inArray(a,["","text"]))return h.readAsText(y);if("json"===a&&window.JSON)return JSON.parse(h.readAsText(y))}finally{y.destroy()}}return null},abort:function(){var a=this.getRuntime();a.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return a.XMLHttpRequest=E}),define("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(a,c){var h={getAsBlob:function(a){var h=this.getRuntime(),g=h.shimExec.call(this,"Transporter","getAsBlob",a);return g?new c(h.uid,g):null}};return a.Transporter=h}),define("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(a,c,h,g,v){var y={loadFromBlob:function(a){function c(a){v.shimExec.call(g,"Image","loadFromBlob",a.uid),g=v=null}var g=this,v=g.getRuntime();if(a.isDetached()){var y=new h;y.bind("TransportingComplete",function(){c(y.result.getSource())}),y.transport(a.getSource(),a.type,{ruid:v.uid})}else c(a.getSource())},loadFromImage:function(a){var c=this.getRuntime();return c.shimExec.call(this,"Image","loadFromImage",a.uid)},getAsBlob:function(a,c){var h=this.getRuntime(),v=h.shimExec.call(this,"Image","getAsBlob",a,c);return v?new g(h.uid,v):null},getAsDataURL:function(){var a,c=this.getRuntime(),h=c.Image.getAsBlob.apply(this,arguments);return h?(a=new v,a.readAsDataURL(h)):null}};return a.Image=y}),define("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(a,c,h,x,g){function v(a){var c,h,g,v,y,w=!1,E=null,R=0;try{try{E=new ActiveXObject("AgControl.AgControl"),E.IsVersionSupported(a)&&(w=!0),E=null}catch(e){var _=navigator.plugins["Silverlight Plug-In"];if(_){for(c=_.description,"1.0.30226.2"===c&&(c="2.0.30226.2"),h=c.split(".");h.length>3;)h.pop();for(;h.length<4;)h.push(0);for(g=a.split(".");g.length>4;)g.pop();do v=parseInt(g[R],10),y=parseInt(h[R],10),R++;while(R<g.length&&v===y);y>=v&&!isNaN(v)&&(w=!0)}}}catch(b){w=!1}return w}function y(y){var R,_=this;y=a.extend({xap_url:c.xap_url},y),g.call(this,y,w,{access_binary:g.capTrue,access_image_binary:g.capTrue,display_media:g.capTrue,do_cors:g.capTrue,drag_and_drop:!1,report_upload_progress:g.capTrue,resize_image:g.capTrue,return_response_headers:function(a){return a&&"client"===_.mode},return_response_type:function(a){return"json"!==a?!0:!!window.JSON},return_status_code:function(c){return"client"===_.mode||!a.arrayDiff(c,[200,404])},select_file:g.capTrue,select_multiple:g.capTrue,send_binary_string:g.capTrue,send_browser_cookies:function(a){return a&&"browser"===_.mode},send_custom_headers:function(a){return a&&"client"===_.mode},send_multipart:g.capTrue,slice_blob:g.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:g.capTrue,use_http_method:function(c){return"client"===_.mode||!a.arrayDiff(c,["GET","POST"])}},{return_response_headers:function(a){return a?"client":"browser"},return_status_code:function(c){return a.arrayDiff(c,[200,404])?"client":["client","browser"]},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"client":"browser"},use_http_method:function(c){return a.arrayDiff(c,["GET","POST"])?"client":["client","browser"]}}),v("2.0.31005.0")&&"Opera"!==c.browser||(this.mode=!1),a.extend(this,{getShim:function(){return h.get(this.uid).content.Moxie},shimExec:function(a,c){var h=[].slice.call(arguments,2);return _.getShim().exec(this.uid,a,c,h)},init:function(){var a;a=this.getShimContainer(),a.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+y.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+c.global_event_dispatcher+'"/></object>',R=setTimeout(function(){_&&!_.initialized&&_.trigger("Error",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR))},"Windows"!==c.OS?1e4:5e3)},destroy:function(a){return function(){a.call(_),clearTimeout(R),y=R=a=_=null}}(this.destroy)},E)}var w="silverlight",E={};return g.addConstructor(w,y),E}),define("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(a,c,h){return a.Blob=c.extend({},h)}),define("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(a){var c={init:function(a){function c(a){for(var c="",i=0;i<a.length;i++)c+=(""!==c?"|":"")+a[i].title+" | *."+a[i].extensions.replace(/,/g,";*.");return c}this.getRuntime().shimExec.call(this,"FileInput","init",c(a.accept),a.name,a.multiple),this.trigger("ready")}};return a.FileInput=c}),define("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(a,c,h){var g={init:function(){var a,g=this,v=g.getRuntime();return a=v.getShimContainer(),h.addEvent(a,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},g.uid),h.addEvent(a,"dragenter",function(e){e.preventDefault();var a=c.get(v.uid).dragEnter(e);a&&e.stopPropagation()},g.uid),h.addEvent(a,"drop",function(e){e.preventDefault();var a=c.get(v.uid).dragDrop(e);a&&e.stopPropagation()},g.uid),v.shimExec.call(this,"FileDrop","init")}};return a.FileDrop=g}),define("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(a,c,h){return a.FileReader=c.extend({},h)}),define("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(a,c,h){return a.FileReaderSync=c.extend({},h)}),define("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(a,c,h){return a.XMLHttpRequest=c.extend({},h)}),define("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(a,c,h){return a.Transporter=c.extend({},h)}),define("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(a,c,h){return a.Image=c.extend({},h,{getInfo:function(){var a=this.getRuntime(),h=["tiff","exif","gps"],g={meta:{}},v=a.shimExec.call(this,"Image","getInfo");return v.meta&&c.each(h,function(a){var c,i,h,y,w=v.meta[a];if(w&&w.keys)for(g.meta[a]={},i=0,h=w.keys.length;h>i;i++)c=w.keys[i],y=w[c],y&&(/^(\d|[1-9]\d+)$/.test(y)?y=parseInt(y,10):/^\d*\.\d+$/.test(y)&&(y=parseFloat(y)),g.meta[a][c]=y)}),g.width=parseInt(v.width,10),g.height=parseInt(v.height,10),g.size=parseInt(v.size,10),g.type=v.type,g.name=v.name,g}})}),define("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(a,x,c,h){function g(g){var w=this,E=c.capTest,R=c.capTrue;c.call(this,g,v,{access_binary:E(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:E(y.Image&&(h.can("create_canvas")||h.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:E(function(){return"Chrome"===h.browser&&h.version>=28||"IE"===h.browser&&h.version>=10}()),resize_image:function(){return y.Image&&w.can("access_binary")&&h.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(c){return"json"===c&&window.JSON?!0:!!~a.inArray(c,["text","document",""])},return_status_code:function(c){return!a.arrayDiff(c,[200,404])},select_file:function(){return h.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return w.can("select_file")},summon_file_dialog:E(function(){return"Firefox"===h.browser&&h.version>=4||"Opera"===h.browser&&h.version>=12||!!~a.inArray(h.browser,["Chrome","Safari"])}()),upload_filesize:R,use_http_method:function(c){return!a.arrayDiff(c,["GET","POST"])}}),a.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(w),a=w=null}}(this.destroy)}),a.extend(this.getShim(),y)}var v="html4",y={};return c.addConstructor(v,g),y}),define("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(a,c,h,g,v,y){function w(){function a(){var v,b,T,S,A,O,I=this,D=I.getRuntime();O=c.guid("uid_"),v=D.getShimContainer(),w&&(T=h.get(w+"_form"),T&&c.extend(T.style,{top:"100%"})),S=document.createElement("form"),S.setAttribute("id",O+"_form"),S.setAttribute("method","post"),S.setAttribute("enctype","multipart/form-data"),S.setAttribute("encoding","multipart/form-data"),c.extend(S.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),A=document.createElement("input"),A.setAttribute("id",O),A.setAttribute("type","file"),A.setAttribute("name",E.name||"Filedata"),A.setAttribute("accept",_.join(",")),c.extend(A.style,{fontSize:"999px",opacity:0}),S.appendChild(A),v.appendChild(S),c.extend(A.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===y.browser&&y.version<10&&c.extend(A.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),A.onchange=function(){var c;this.value&&(c=this.files?this.files[0]:{name:this.value},R=[c],this.onchange=function(){},a.call(I),I.bind("change",function g(){var a,c=h.get(O),v=h.get(O+"_form");I.unbind("change",g),I.files.length&&c&&v&&(a=I.files[0],c.setAttribute("id",a.uid),v.setAttribute("id",a.uid+"_form"),v.setAttribute("target",a.uid+"_iframe")),c=v=null},998),A=S=null,I.trigger("change"))},D.can("summon_file_dialog")&&(b=h.get(E.browse_button),g.removeEvent(b,"click",I.uid),g.addEvent(b,"click",function(e){A&&!A.disabled&&A.click(),e.preventDefault()},I.uid)),w=O,v=T=b=null}var w,E,R=[],_=[];c.extend(this,{init:function(c){var y,w=this,R=w.getRuntime();E=c,_=c.accept.mimes||v.extList2mimes(c.accept,R.can("filter_by_extension")),y=R.getShimContainer(),function(){var a,v,E;a=h.get(c.browse_button),R.can("summon_file_dialog")&&("static"===h.getStyle(a,"position")&&(a.style.position="relative"),v=parseInt(h.getStyle(a,"z-index"),10)||1,a.style.zIndex=v,y.style.zIndex=v-1),E=R.can("summon_file_dialog")?a:y,g.addEvent(E,"mouseover",function(){w.trigger("mouseenter")},w.uid),g.addEvent(E,"mouseout",function(){w.trigger("mouseleave")},w.uid),g.addEvent(E,"mousedown",function(){w.trigger("mousedown")},w.uid),g.addEvent(h.get(c.container),"mouseup",function(){w.trigger("mouseup")},w.uid),a=null}(),a.call(this),y=null,w.trigger({type:"ready",async:!0})},getFiles:function(){return R},disable:function(a){var c;(c=h.get(w))&&(c.disabled=!!a)},destroy:function(){var a=this.getRuntime(),c=a.getShim(),v=a.getShimContainer();g.removeAllEvents(v,this.uid),g.removeAllEvents(E&&h.get(E.container),this.uid),g.removeAllEvents(E&&h.get(E.browse_button),this.uid),v&&(v.innerHTML=""),c.removeInstance(this.uid),w=R=_=E=v=c=null}})}return a.FileInput=w}),define("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(a,c){return a.FileReader=c}),define("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(a,c,h,g,x,v,y,w){function E(){function a(a){var c,g,y,i,w=this,E=!1;if(_){if(c=_.id.replace(/_iframe$/,""),g=h.get(c+"_form")){for(y=g.getElementsByTagName("input"),i=y.length;i--;)switch(y[i].getAttribute("type")){case"hidden":y[i].parentNode.removeChild(y[i]);break;case"file":E=!0}y=[],E||g.parentNode.removeChild(g),g=null}setTimeout(function(){v.removeEvent(_,"load",w.uid),_.parentNode&&_.parentNode.removeChild(_);var c=w.getRuntime().getShimContainer();c.children.length||c.parentNode.removeChild(c),c=_=null,a()},1)}}var E,R,_;c.extend(this,{send:function(b,T){function S(){var h=L.getShimContainer()||document.body,y=document.createElement("div");y.innerHTML='<iframe id="'+A+'_iframe" name="'+A+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',_=y.firstChild,h.appendChild(_),v.addEvent(_,"load",function(){var h;try{h=_.contentWindow.document||_.contentDocument||window.frames[_.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(h.title)?E=h.title.replace(/^(\d+).*$/,"$1"):(E=200,R=c.trim(h.body.innerHTML),N.trigger({type:"progress",loaded:R.length,total:R.length}),D&&N.trigger({type:"uploadprogress",loaded:D.size||1025,total:D.size||1025}))}catch(ex){if(!g.hasSameOrigin(b.url))return void a.call(N,function(){N.trigger("error")});E=404}a.call(N,function(){N.trigger("load")})},N.uid)}var A,O,I,D,N=this,L=N.getRuntime();if(E=R=null,T instanceof w&&T.hasBlob()){if(D=T.getBlob(),A=D.uid,I=h.get(A),O=h.get(A+"_form"),!O)throw new x.DOMException(x.DOMException.NOT_FOUND_ERR)}else A=c.guid("uid_"),O=document.createElement("form"),O.setAttribute("id",A+"_form"),O.setAttribute("method",b.method),O.setAttribute("enctype","multipart/form-data"),O.setAttribute("encoding","multipart/form-data"),O.setAttribute("target",A+"_iframe"),L.getShimContainer().appendChild(O);T instanceof w&&T.each(function(a,h){if(a instanceof y)I&&I.setAttribute("name",h);else{var g=document.createElement("input");c.extend(g,{type:"hidden",name:h,value:a}),I?O.insertBefore(g,I):O.appendChild(g)
}}),O.setAttribute("action",b.url),S(),O.submit(),N.trigger("loadstart")},getStatus:function(){return E},getResponse:function(a){if("json"===a&&"string"===c.typeOf(R)&&window.JSON)try{return JSON.parse(R.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(ex){return null}return R},abort:function(){var c=this;_&&_.contentWindow&&(_.contentWindow.stop?_.contentWindow.stop():_.contentWindow.document.execCommand?_.contentWindow.document.execCommand("Stop"):_.src="about:blank"),a.call(this,function(){c.dispatchEvent("abort")})}})}return a.XMLHttpRequest=E}),define("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(a,c){return a.Image=c}),h(["moxie/core/utils/Basic","moxie/core/I18n","moxie/core/utils/Mime","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/file/File","moxie/file/FileInput","moxie/file/FileDrop","moxie/runtime/RuntimeTarget","moxie/file/FileReader","moxie/core/utils/Url","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/image/Image","moxie/core/utils/Events"])}(this),function(){"use strict";var o={},a=moxie.core.utils.Basic.inArray;return function c(h){var g,v;for(g in h)v=typeof h[g],"object"!==v||~a(g,["Exceptions","Env","Mime"])?"function"===v&&(o[g]=h[g]):c(h[g])}(window.moxie),o.Env=window.moxie.core.utils.Env,o.Mime=window.moxie.core.utils.Mime,o.Exceptions=window.moxie.core.Exceptions,window.mOxie=o,window.o||(window.o=o),o}();