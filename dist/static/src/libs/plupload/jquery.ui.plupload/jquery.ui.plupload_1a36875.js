!function(a,_,c,o,h){function b(a){return c.translate(a)||a}function v(a){a.id=a.attr("id"),a.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_logo"> </div><div class="plupload_header_title">'+b("Select files")+'</div><div class="plupload_header_text">'+b("Add files to the upload queue and click the start button.")+'</div><div class="plupload_view_switch"><input type="radio" id="'+a.id+'_view_list" name="view_mode_'+a.id+'" checked="checked" /><label class="plupload_button" for="'+a.id+'_view_list" data-view="list">'+b("List")+'</label><input type="radio" id="'+a.id+'_view_thumbs" name="view_mode_'+a.id+'" /><label class="plupload_button"  for="'+a.id+'_view_thumbs" data-view="thumbs">'+b("Thumbnails")+'</label></div></div></div><table class="plupload_filelist plupload_filelist_header ui-widget-header"><tr><td class="plupload_cell plupload_file_name">'+b("Filename")+'</td><td class="plupload_cell plupload_file_status">'+b("Status")+'</td><td class="plupload_cell plupload_file_size">'+b("Size")+'</td><td class="plupload_cell plupload_file_action">&nbsp;</td></tr></table><div class="plupload_content"><div class="plupload_droptext">'+b("Drag files here.")+'</div><ul class="plupload_filelist_content"> </ul><div class="plupload_clearer">&nbsp;</div></div><table class="plupload_filelist plupload_filelist_footer ui-widget-header"><tr><td class="plupload_cell plupload_file_name"><div class="plupload_buttons"><!-- Visible --><a class="plupload_button plupload_add">'+b("Add Files")+'</a>&nbsp;<a class="plupload_button plupload_start">'+b("Start Upload")+'</a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+b("Stop Upload")+'</a>&nbsp;</div><div class="plupload_started plupload_hidden"><!-- Hidden --><div class="plupload_progress plupload_right"><div class="plupload_progress_container"></div></div><div class="plupload_cell plupload_upload_status"></div><div class="plupload_clearer">&nbsp;</div></div></td><td class="plupload_file_status"><span class="plupload_total_status">0%</span></td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td><td class="plupload_file_action"></td></tr></table></div><input class="plupload_count" value="0" type="hidden"></div>')}var g={};h.widget("ui.plupload",{widgetEventPrefix:"",contents_bak:"",options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",filters:{},buttons:{browse:!0,start:!0,stop:!0},views:{list:!0,thumbs:!1,active:"list",remember:!0},thumb_width:100,thumb_height:60,multiple_queues:!0,dragdrop:!0,autostart:!1,sortable:!1,rename:!1},FILE_COUNT_ERROR:-9001,_create:function(){var a=this.element.attr("id");a||(a=c.guid(),this.element.attr("id",a)),this.id=a,this.contents_bak=this.element.html(),v(this.element),this.container=h(".plupload_container",this.element).attr("id",a+"_container"),this.content=h(".plupload_content",this.element),h.fn.resizable&&this.container.resizable({handles:"s",minHeight:300}),this.filelist=h(".plupload_filelist_content",this.container).attr({id:a+"_filelist",unselectable:"on"}),this.browse_button=h(".plupload_add",this.container).attr("id",a+"_browse"),this.start_button=h(".plupload_start",this.container).attr("id",a+"_start"),this.stop_button=h(".plupload_stop",this.container).attr("id",a+"_stop"),this.thumbs_switcher=h("#"+a+"_view_thumbs"),this.list_switcher=h("#"+a+"_view_list"),h.ui.button&&(this.browse_button.button({icons:{primary:"ui-icon-circle-plus"},disabled:!0}),this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:!0}),this.stop_button.button({icons:{primary:"ui-icon-circle-close"}}),this.list_switcher.button({text:!1,icons:{secondary:"ui-icon-grip-dotted-horizontal"}}),this.thumbs_switcher.button({text:!1,icons:{secondary:"ui-icon-image"}})),this.progressbar=h(".plupload_progress_container",this.container),h.ui.progressbar&&this.progressbar.progressbar(),this.counter=h(".plupload_count",this.element).attr({id:a+"_count",name:a+"_count"}),this._initUploader()},_initUploader:function(){var a,_=this,v=this.id,w={container:v+"_buttons",browse_button:v+"_browse"};h(".plupload_buttons",this.element).attr("id",v+"_buttons"),_.options.dragdrop&&(this.filelist.parent().attr("id",this.id+"_dropbox"),w.drop_element=this.id+"_dropbox"),this.filelist.on("click",function(e){h(e.target).hasClass("plupload_action_icon")&&(_.removeFile(h(e.target).closest(".plupload_file").attr("id")),e.preventDefault())}),a=this.uploader=g[v]=new c.Uploader(h.extend(this.options,w)),this.options=a.getOption(),_.options.views.thumbs&&(a.settings.required_features.display_media=!0),_.options.max_file_count&&c.extend(a.getOption("filters"),{max_file_count:_.options.max_file_count}),c.addFileFilter("max_file_count",function(a,c,h){a<=this.files.length-(this.total.uploaded+this.total.failed)?(_.browse_button.button("disable"),this.disableBrowse(),this.trigger("Error",{code:_.FILE_COUNT_ERROR,message:b("File count error."),file:c}),h(!1)):h(!0)}),a.bind("Error",function(a,h){var v,g="";switch(v="<strong>"+h.message+"</strong>",h.code){case c.FILE_EXTENSION_ERROR:g=o.sprintf(b("File: %s"),h.file.name);break;case c.FILE_SIZE_ERROR:g=o.sprintf(b("File: %s, size: %d, max file size: %d"),h.file.name,c.formatSize(h.file.size),c.formatSize(c.parseSize(a.getOption("filters").max_file_size)));break;case c.FILE_DUPLICATE_ERROR:g=o.sprintf(b("%s already present in the queue."),h.file.name);break;case _.FILE_COUNT_ERROR:g=o.sprintf(b("Upload element accepts only %d file(s) at a time. Extra files were stripped."),a.getOption("filters").max_file_count||0);break;case c.IMAGE_FORMAT_ERROR:g=b("Image format either wrong or not supported.");break;case c.IMAGE_MEMORY_ERROR:g=b("Runtime ran out of available memory.");break;case c.HTTP_ERROR:g=b("Upload URL might be wrong or doesn't exist.")}v+=" <br /><i>"+g+"</i>",_._trigger("error",null,{up:a,error:h}),h.code===c.INIT_ERROR?setTimeout(function(){_.destroy()},1):_.notify("error",v)}),a.bind("PostInit",function(a){_.options.buttons.browse?_.browse_button.button("enable"):(_.browse_button.button("disable").hide(),a.disableBrowse(!0)),_.options.buttons.start||_.start_button.button("disable").hide(),_.options.buttons.stop||_.stop_button.button("disable").hide(),!_.options.unique_names&&_.options.rename&&_._enableRenaming(),_.options.dragdrop&&a.features.dragdrop&&_.filelist.parent().addClass("plupload_dropbox"),_._enableViewSwitcher(),_.start_button.click(function(e){h(this).button("option","disabled")||_.start(),e.preventDefault()}),_.stop_button.click(function(e){_.stop(),e.preventDefault()}),_._trigger("ready",null,{up:a})}),a.init(),a.bind("FileFiltered",function(a,c){_._addFiles(c)}),a.bind("FilesAdded",function(a,c){_._trigger("selected",null,{up:a,files:c}),_.options.sortable&&h.ui.sortable&&_._enableSortingList(),_._trigger("updatelist",null,{filelist:_.filelist}),_.options.autostart&&setTimeout(function(){_.start()},10)}),a.bind("FilesRemoved",function(a,c){h.ui.sortable&&_.options.sortable&&h("tbody",_.filelist).sortable("destroy"),h.each(c,function(i,a){h("#"+a.id).toggle("highlight",function(){h(this).remove()})}),a.files.length&&_.options.sortable&&h.ui.sortable&&_._enableSortingList(),_._trigger("updatelist",null,{filelist:_.filelist}),_._trigger("removed",null,{up:a,files:c})}),a.bind("QueueChanged",function(){_._handleState()}),a.bind("StateChanged",function(a){_._handleState(),c.STARTED===a.state?_._trigger("started",null,{up:this.uploader}):c.STOPPED===a.state&&_._trigger("stopped",null,{up:this.uploader})}),a.bind("UploadFile",function(a,c){_._handleFileStatus(c)}),a.bind("FileUploaded",function(a,c,h){_._handleFileStatus(c),_._trigger("uploaded",null,{up:a,file:c,result:h})}),a.bind("UploadProgress",function(a,c){_._handleFileStatus(c),_._updateTotalProgress(),_._trigger("progress",null,{up:a,file:c})}),a.bind("UploadComplete",function(a,c){_._addFormFields(),_._trigger("complete",null,{up:a,files:c})})},_setOption:function(a,_){var c=this;"buttons"==a&&"object"==typeof _&&(_=h.extend(c.options.buttons,_),_.browse?(c.browse_button.button("enable").show(),c.uploader.disableBrowse(!1)):(c.browse_button.button("disable").hide(),c.uploader.disableBrowse(!0)),_.start?c.start_button.button("enable").show():c.start_button.button("disable").hide(),_.stop?c.start_button.button("enable").show():c.stop_button.button("disable").hide()),c.uploader.setOption(a,_)},start:function(){this.uploader.start()},stop:function(){this.uploader.stop()},enable:function(){this.browse_button.button("enable"),this.uploader.disableBrowse(!1)},disable:function(){this.browse_button.button("disable"),this.uploader.disableBrowse(!0)},getFile:function(a){var _;return _="number"==typeof a?this.uploader.files[a]:this.uploader.getFile(a)},getFiles:function(){return this.uploader.files},removeFile:function(a){"string"===c.typeOf(a)&&(a=this.getFile(a)),this.uploader.removeFile(a)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(a,_){var c=h('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+b("Close")+'"></span><p><span class="ui-icon"></span>'+_+"</p></div>");c.addClass("ui-state-"+("error"===a?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+("error"===a?"alert":"info")).end().find(".plupload_message_close").click(function(){c.remove()}).end(),h(".plupload_header",this.container).append(c)},destroy:function(){this.uploader.destroy(),h(".plupload_button",this.element).unbind(),h.ui.button&&h(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy"),h.ui.progressbar&&this.progressbar.progressbar("destroy"),h.ui.sortable&&this.options.sortable&&h("tbody",this.filelist).sortable("destroy"),this.element.empty().html(this.contents_bak),this.contents_bak="",h.Widget.prototype.destroy.apply(this)},_handleState:function(){var a=this.uploader,_=a.files.length-(a.total.uploaded+a.total.failed),v=a.getOption("filters").max_file_count||0;c.STARTED===a.state?(h([]).add(this.stop_button).add(".plupload_started").removeClass("plupload_hidden"),this.start_button.button("disable"),this.options.multiple_queues||(this.browse_button.button("disable"),a.disableBrowse()),h(".plupload_upload_status",this.element).html(o.sprintf(b("Uploaded %d/%d files"),a.total.uploaded,a.files.length)),h(".plupload_header_content",this.element).addClass("plupload_header_content_bw")):c.STOPPED===a.state&&(h([]).add(this.stop_button).add(".plupload_started").addClass("plupload_hidden"),this.start_button.button(_?"enable":"disable"),this.options.multiple_queues&&h(".plupload_header_content",this.element).removeClass("plupload_header_content_bw"),this.options.multiple_queues&&v&&v>_&&(this.browse_button.button("enable"),a.disableBrowse(!1)),this._updateTotalProgress()),h(".ui-button-text",this.browse_button).html(0===a.total.queued?b("Add Files"):o.sprintf(b("%d files queued"),a.total.queued)),a.refresh()},_handleFileStatus:function(a){var _,b,v=h("#"+a.id);if(v.length){switch(a.status){case c.DONE:_="plupload_done",b="plupload_action_icon ui-icon ui-icon-circle-check";break;case c.FAILED:_="ui-state-error plupload_failed",b="plupload_action_icon ui-icon ui-icon-alert";break;case c.QUEUED:_="plupload_delete",b="plupload_action_icon ui-icon ui-icon-circle-minus";break;case c.UPLOADING:_="ui-state-highlight plupload_uploading",b="plupload_action_icon ui-icon ui-icon-circle-arrow-w";var g=h(".plupload_scroll",this.container),w=g.scrollTop(),y=g.height(),E=v.position().top+v.height();E>y&&g.scrollTop(w+E-y),v.find(".plupload_file_percent").html(a.percent+"%").end().find(".plupload_file_progress").css("width",a.percent+"%").end().find(".plupload_file_size").html(c.formatSize(a.size))}_+=" ui-state-default plupload_file",v.attr("class",_).find(".plupload_action_icon").attr("class",b)}},_updateTotalProgress:function(){var a=this.uploader;this.filelist[0].scrollTop=this.filelist[0].scrollHeight,this.progressbar.progressbar("value",a.total.percent),this.element.find(".plupload_total_status").html(a.total.percent+"%").end().find(".plupload_total_file_size").html(c.formatSize(a.total.size)).end().find(".plupload_upload_status").html(o.sprintf(b("Uploaded %d/%d files"),a.total.uploaded,a.files.length))},_displayThumbs:function(){function a(a,_,c){var h;a.on(_,function(){clearTimeout(h),h=setTimeout(function(){clearTimeout(h),c()},300)})}function _(){if(!w||!y){var a=h(".plupload_file:eq(0)",F.filelist);w=a.outerWidth(!0),y=a.outerHeight(!0)}var _=F.content.width(),c=F.content.height();E=Math.floor(_/w),R=E*(Math.ceil(c/y)+1)}function c(){var a=Math.floor(F.content.scrollTop()/y)*E;k=h(".plupload_file .plupload_file_thumb",F.filelist).slice(a,a+R).filter(".plupload_thumb_toload").get()}function b(){function b(){"thumbs"===F.view_mode&&(_(),c(),g())}h.fn.resizable&&a(F.container,"resize",b),a(F.window,"resize",b),a(F.content,"scroll",b),F.element.on("viewchanged selected",b),b()}function v(a,_){var c=new o.Image;c.onload=function(){var _=h("#"+a.id+" .plupload_file_thumb",F.filelist);this.embed(_[0],{width:F.options.thumb_width,height:F.options.thumb_height,crop:!0,preserveHeaders:!1,swf_url:o.resolveUrl(F.options.flash_swf_url),xap_url:o.resolveUrl(F.options.silverlight_xap_url)})},c.bind("embedded error",function(e){h("#"+a.id,F.filelist).find(".plupload_file_thumb").removeClass("plupload_thumb_loading").addClass("plupload_thumb_"+e.type),this.destroy(),setTimeout(_,1)}),h("#"+a.id,F.filelist).find(".plupload_file_thumb").removeClass("plupload_thumb_toload").addClass("plupload_thumb_loading"),c.load(a.getSource())}function g(){"thumbs"!==F.view_mode||O||(c(),k.length&&(O=!0,v(F.getFile(h(k.shift()).closest(".plupload_file").attr("id")),function(){O=!1,g()})))}var w,y,E,F=this,R=0,k=[],O=!1;this.options.views.thumbs&&this.element.on("selected",function S(){F.element.off("selected",S),b()})},_addFiles:function(a){var _,b=this,v="";_='<li class="plupload_file ui-state-default plupload_delete" id="{id}" style="width:{thumb_width}px;"><div class="plupload_file_thumb plupload_thumb_toload" style="width: {thumb_width}px; height: {thumb_height}px;"><div class="plupload_file_dummy ui-widget-content" style="line-height: {thumb_height}px;"><span class="ui-state-disabled">{ext} </span></div></div><div class="plupload_file_status"><div class="plupload_file_progress ui-widget-header" style="width: 0%"> </div><span class="plupload_file_percent">{percent} </span></div><div class="plupload_file_name" title="{name}"><span class="plupload_file_name_wrapper">{name} </span></div><div class="plupload_file_action"><div class="plupload_action_icon ui-icon ui-icon-circle-minus"> </div></div><div class="plupload_file_size">{size} </div><div class="plupload_file_fields"> </div></li>',"array"!==c.typeOf(a)&&(a=[a]),h.each(a,function(i,a){var h=o.Mime.getFileExtension(a.name)||"none";v+=_.replace(/\{(\w+)\}/g,function(_,v){switch(v){case"thumb_width":case"thumb_height":return b.options[v];case"size":return c.formatSize(a.size);case"ext":return h;default:return a[v]||""}})}),b.filelist.append(v)},_addFormFields:function(){var a=this;h(".plupload_file_fields",this.filelist).html(""),c.each(this.uploader.files,function(_,b){var v="",g=a.id+"_"+b;_.target_name&&(v+='<input type="hidden" name="'+g+'_tmpname" value="'+c.xmlEncode(_.target_name)+'" />'),v+='<input type="hidden" name="'+g+'_name" value="'+c.xmlEncode(_.name)+'" />',v+='<input type="hidden" name="'+g+'_status" value="'+(_.status===c.DONE?"done":"failed")+'" />',h("#"+_.id).find(".plupload_file_fields").html(v)}),this.counter.val(this.uploader.files.length)},_viewChanged:function(a){this.options.views.remember&&h.cookie&&h.cookie("plupload_ui_view",a,{expires:7,path:"/"}),"IE"===o.Env.browser&&o.Env.version<7&&this.content.attr("style",'height:expression(document.getElementById("'+this.id+'_container").clientHeight - '+("list"===a?132:102)+")"),this.container.removeClass("plupload_view_list plupload_view_thumbs").addClass("plupload_view_"+a),this.view_mode=a,this._trigger("viewchanged",null,{view:a})},_enableViewSwitcher:function(){var a,_,b,v=this,g=h(".plupload_view_switch",this.container);c.each(["list","thumbs"],function(a){v.options.views[a]||g.find('[for="'+v.id+"_view_"+a+'"], #'+v.id+"_view_"+a).remove()}),_=g.find(".plupload_button"),1===_.length?(g.hide(),a=_.eq(0).data("view"),this._viewChanged(a)):h.ui.button&&_.length>1?(this.options.views.remember&&h.cookie&&(a=h.cookie("plupload_ui_view")),~c.inArray(a,["list","thumbs"])||(a=this.options.views.active),g.show().buttonset().find(".ui-button").click(function(e){a=h(this).data("view"),v._viewChanged(a),e.preventDefault()}),b=g.find('[for="'+v.id+"_view_"+a+'"]'),b.length&&b.trigger("click")):(g.show(),this._viewChanged(this.options.views.active)),this.options.views.thumbs&&this._displayThumbs()},_enableRenaming:function(){var a=this;this.filelist.dblclick(function(e){var _,c,b,v,g=h(e.target),w="";g.hasClass("plupload_file_name_wrapper")&&(c=a.uploader.getFile(g.closest(".plupload_file")[0].id),v=c.name,b=/^(.+)(\.[^.]+)$/.exec(v),b&&(v=b[1],w=b[2]),_=h('<input class="plupload_file_rename" type="text" />').width(g.width()).insertAfter(g.hide()),_.val(v).blur(function(){g.show().parent().scrollLeft(0).end().next().remove()}).keydown(function(e){var a=h(this);-1!==h.inArray(e.keyCode,[13,27])&&(e.preventDefault(),13===e.keyCode&&(c.name=a.val()+w,g.html(c.name)),a.blur())})[0].focus())})},_enableSortingList:function(){var a=this;h(".plupload_file",this.filelist).length<2||(h("tbody",this.filelist).sortable("destroy"),this.filelist.sortable({items:".plupload_delete",cancel:"object, .plupload_clearer",stop:function(){var _=[];h.each(h(this).sortable("toArray"),function(i,c){_[_.length]=a.uploader.getFile(c)}),_.unshift(_.length),_.unshift(0),Array.prototype.splice.apply(a.uploader.files,_)}}))}})}(window,document,plupload,mOxie,jQuery);