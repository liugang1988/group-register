!function(a,o,c){function g(a){function c(a,c,g){var _={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};_[a]?h[_[a]]=c:g||(h[a]=c)}var g=a.required_features,h={};return"string"==typeof g?E.each(g.split(/\s*,\s*/),function(a){c(a,!0)}):"object"==typeof g?E.each(g,function(a,g){c(g,a)}):g===!0&&(a.multipart||(h.send_binary_string=!0),a.chunk_size>0&&(h.slice_blob=!0),a.resize.enabled&&(h.send_binary_string=!0),E.each(a,function(a,g){c(g,!!a,!0)})),h}var h=a.setTimeout,_={},E={VERSION:"2.1.1",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:o.mimes,ua:o.ua,typeOf:o.typeOf,extend:o.extend,guid:o.guid,get:function(a){var c,g=[];"array"!==o.typeOf(a)&&(a=[a]);for(var i=a.length;i--;)c=o.get(a[i]),c&&g.push(c);return g.length?g:null},each:o.each,getPos:o.getPos,getSize:o.getSize,xmlEncode:function(a){var c={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},g=/[<>&\"\']/g;return a?(""+a).replace(g,function(a){return c[a]?"&"+c[a]+";":a}):a},toArray:o.toArray,inArray:o.inArray,addI18n:o.addI18n,translate:o.translate,isEmptyObj:o.isEmptyObj,hasClass:o.hasClass,addClass:o.addClass,removeClass:o.removeClass,getStyle:o.getStyle,addEvent:o.addEvent,removeEvent:o.removeEvent,removeAllEvents:o.removeAllEvents,cleanName:function(a){var i,c;for(c=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],i=0;i<c.length;i+=2)a=a.replace(c[i],c[i+1]);return a=a.replace(/\s+/g,"_"),a=a.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(a,c){var g="";return E.each(c,function(a,c){g+=(g?"&":"")+encodeURIComponent(c)+"="+encodeURIComponent(a)}),g&&(a+=(a.indexOf("?")>0?"&":"?")+g),a},formatSize:function(a){function g(a,c){return Math.round(a*Math.pow(10,c))/Math.pow(10,c)}if(a===c||/\D/.test(a))return E.translate("N/A");var h=Math.pow(1024,4);return a>h?g(a/h,1)+" "+E.translate("tb"):a>(h/=1024)?g(a/h,1)+" "+E.translate("gb"):a>(h/=1024)?g(a/h,1)+" "+E.translate("mb"):a>1024?Math.round(a/1024)+" "+E.translate("kb"):a+" "+E.translate("b")},parseSize:o.parseSizeStr,predictRuntime:function(a,c){var g,h;return g=new E.Uploader(a),h=o.Runtime.thatCan(g.getOption().required_features,c||a.runtimes),g.destroy(),h},addFileFilter:function(a,c){_[a]=c}};E.addFileFilter("mime_types",function(a,c,g){a.length&&!a.regexp.test(c.name)?(this.trigger("Error",{code:E.FILE_EXTENSION_ERROR,message:E.translate("File extension error."),file:c}),g(!1)):g(!0)}),E.addFileFilter("max_file_size",function(a,c,g){var h;a=E.parseSize(a),c.size!==h&&a&&c.size>a?(this.trigger("Error",{code:E.FILE_SIZE_ERROR,message:E.translate("File size error."),file:c}),g(!1)):g(!0)}),E.addFileFilter("prevent_duplicates",function(a,c,g){if(a)for(var h=this.files.length;h--;)if(c.name===this.files[h].name&&c.size===this.files[h].size)return this.trigger("Error",{code:E.FILE_DUPLICATE_ERROR,message:E.translate("Duplicate file error."),file:c}),void g(!1);g(!0)}),E.Uploader=function(a){function R(){var a,i,c=0;if(this.state==E.STARTED){for(i=0;i<B.length;i++)a||B[i].status!=E.QUEUED?c++:(a=B[i],this.trigger("BeforeUpload",a)&&(a.status=E.UPLOADING,this.trigger("UploadFile",a)));c==B.length&&(this.state!==E.STOPPED&&(this.state=E.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",B))}}function b(a){a.percent=a.size>0?Math.ceil(a.loaded/a.size*100):100,v()}function v(){var i,a;for(H.reset(),i=0;i<B.length;i++)a=B[i],a.size!==c?(H.size+=a.origSize,H.loaded+=a.loaded*a.origSize/a.size):H.size=c,a.status==E.DONE?H.uploaded++:a.status==E.FAILED?H.failed++:H.queued++;H.size===c?H.percent=B.length>0?Math.ceil(H.uploaded/B.length*100):0:(H.bytesPerSec=Math.ceil(H.loaded/((+new Date-L||1)/1e3)),H.percent=H.size>0?Math.ceil(H.loaded/H.size*100):0)}function y(){var a=$[0]||X[0];return a?a.getRuntime().uid:!1}function z(a,c){if(a.ruid){var g=o.Runtime.getInfo(a.ruid);if(g)return g.can(c)}return!1}function S(){this.bind("FilesAdded",D),this.bind("CancelUpload",P),this.bind("BeforeUpload",T),this.bind("UploadFile",F),this.bind("UploadProgress",A),this.bind("StateChanged",U),this.bind("QueueChanged",v),this.bind("Error",M),this.bind("FileUploaded",C),this.bind("Destroy",N)}function O(a,c){var g=this,h=0,_=[],R={accept:a.filters.mime_types,runtime_order:a.runtimes,required_caps:a.required_features,preferred_caps:G,swf_url:a.flash_swf_url,xap_url:a.silverlight_xap_url};E.each(a.runtimes.split(/\s*,\s*/),function(c){a[c]&&(R[c]=a[c])}),a.browse_button&&E.each(a.browse_button,function(c){_.push(function(_){var b=new o.FileInput(E.extend({},R,{name:a.file_data_name,multiple:a.multi_selection,container:a.container,browse_button:c}));b.onready=function(){var a=o.Runtime.getInfo(this.ruid);o.extend(g.features,{chunks:a.can("slice_blob"),multipart:a.can("send_multipart"),multi_selection:a.can("select_multiple")}),h++,$.push(this),_()},b.onchange=function(){g.addFile(this.files)},b.bind("mouseenter mouseleave mousedown mouseup",function(e){Y||(a.browse_button_hover&&("mouseenter"===e.type?o.addClass(c,a.browse_button_hover):"mouseleave"===e.type&&o.removeClass(c,a.browse_button_hover)),a.browse_button_active&&("mousedown"===e.type?o.addClass(c,a.browse_button_active):"mouseup"===e.type&&o.removeClass(c,a.browse_button_active)))}),b.bind("error runtimeerror",function(){b=null,_()}),b.init()})}),a.drop_element&&E.each(a.drop_element,function(a){_.push(function(c){var _=new o.FileDrop(E.extend({},R,{drop_zone:a}));_.onready=function(){var a=o.Runtime.getInfo(this.ruid);g.features.dragdrop=a.can("drag_and_drop"),h++,X.push(this),c()},_.ondrop=function(){g.addFile(this.files)},_.bind("error runtimeerror",function(){_=null,c()}),_.init()})}),o.inSeries(_,function(){"function"==typeof c&&c(h)})}function I(a,c,g){var h=new o.Image;try{h.onload=function(){h.downsize(c.width,c.height,c.crop,c.preserve_headers)},h.onresize=function(){g(this.getAsBlob(a.type,c.quality)),this.destroy()},h.onerror=function(){g(a)},h.load(a)}catch(ex){g(a)}}function w(a,c,h){function _(a,c,g){var h=k[a];switch(a){case"max_file_size":"max_file_size"===a&&(k.max_file_size=k.filters.max_file_size=c);break;case"chunk_size":(c=E.parseSize(c))&&(k[a]=c);break;case"filters":"array"===E.typeOf(c)&&(c={mime_types:c}),g?E.extend(k.filters,c):k.filters=c,c.mime_types&&(k.filters.mime_types.regexp=function(a){var c=[];return E.each(a,function(a){E.each(a.extensions.split(/,/),function(a){c.push(/^\s*\*\s*$/.test(a)?"\\.*":"\\."+a.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+c.join("|")+")$","i")}(k.filters.mime_types));break;case"resize":g?E.extend(k.resize,c,{enabled:!0}):k.resize=c;break;case"prevent_duplicates":k.prevent_duplicates=k.filters.prevent_duplicates=!!c;break;case"browse_button":case"drop_element":c=E.get(c);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":k[a]=c,g||(b=!0);break;default:k[a]=c}g||R.trigger("OptionChanged",a,c,h)}var R=this,b=!1;"object"==typeof a?E.each(a,function(a,c){_(c,a,h)}):_(a,c,h),h?(k.required_features=g(E.extend({},k)),G=g(E.extend({},k,{required_features:!0}))):b&&(R.trigger("Destroy"),O.call(R,k,function(a){a?(R.runtime=o.Runtime.getInfo(y()).type,R.trigger("Init",{runtime:R.runtime}),R.trigger("PostInit")):R.trigger("Error",{code:E.INIT_ERROR,message:E.translate("Init error.")})}))}function D(a,c){[].push.apply(B,c),a.trigger("QueueChanged"),a.refresh()}function T(a,c){if(k.unique_names){var g=c.name.match(/\.([^.]+)$/),h="part";g&&(h=g[1]),c.target_name=c.id+"."+h}}function F(a,c){function g(){y-->0?h(_,1e3):(c.loaded=O,a.trigger("Error",{code:E.HTTP_ERROR,message:E.translate("HTTP Error."),file:c,response:j.responseText,status:j.status,responseHeaders:j.getAllResponseHeaders()}))}function _(){var z,I,w,D;c.status!=E.DONE&&c.status!=E.FAILED&&a.state!=E.STOPPED&&(w={name:c.target_name||c.name},v&&S.chunks&&R.size>v?(D=Math.min(v,R.size-O),z=R.slice(O,O+D)):(D=R.size,z=R),v&&S.chunks&&(a.settings.send_chunk_number?(w.chunk=Math.ceil(O/v),w.chunks=Math.ceil(R.size/v)):(w.offset=O,w.total=R.size)),j=new o.XMLHttpRequest,j.upload&&(j.upload.onprogress=function(e){c.loaded=Math.min(c.size,O+e.loaded),a.trigger("UploadProgress",c)}),j.onload=function(){return j.status>=400?void g():(y=a.settings.max_retries,D<R.size?(z.destroy(),O+=D,c.loaded=Math.min(O,R.size),a.trigger("ChunkUploaded",c,{offset:c.loaded,total:R.size,response:j.responseText,status:j.status,responseHeaders:j.getAllResponseHeaders()}),"Android Browser"===o.Env.browser&&a.trigger("UploadProgress",c)):c.loaded=c.size,z=I=null,void(!O||O>=R.size?(c.size!=c.origSize&&(R.destroy(),R=null),a.trigger("UploadProgress",c),c.status=E.DONE,a.trigger("FileUploaded",c,{response:j.responseText,status:j.status,responseHeaders:j.getAllResponseHeaders()})):h(_,1)))},j.onerror=function(){g()},j.onloadend=function(){this.destroy(),j=null},a.settings.multipart&&S.multipart?(w.name=c.target_name||c.name,j.open("post",b,!0),E.each(a.settings.headers,function(a,c){j.setRequestHeader(c,a)}),I=new o.FormData,E.each(E.extend(w,a.settings.multipart_params),function(a,c){I.append(c,a)}),I.append(a.settings.file_data_name,z),j.send(I,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:G,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})):(b=E.buildUrl(a.settings.url,E.extend(w,a.settings.multipart_params)),j.open("post",b,!0),j.setRequestHeader("Content-Type","application/octet-stream"),E.each(a.settings.headers,function(a,c){j.setRequestHeader(c,a)}),j.send(z,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:G,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})))}var R,b=a.settings.url,v=a.settings.chunk_size,y=a.settings.max_retries,S=a.features,O=0;c.loaded&&(O=c.loaded=v*Math.floor(c.loaded/v)),R=c.getSource(),a.settings.resize.enabled&&z(R,"send_binary_string")&&~o.inArray(R.type,["image/jpeg","image/png"])?I.call(this,R,a.settings.resize,function(a){R=a,c.size=a.size,_()}):_()}function A(a,c){b(c)}function U(a){if(a.state==E.STARTED)L=+new Date;else if(a.state==E.STOPPED)for(var i=a.files.length-1;i>=0;i--)a.files[i].status==E.UPLOADING&&(a.files[i].status=E.QUEUED,v())}function P(){j&&j.abort()}function C(a){v(),h(function(){R.call(a)},1)}function M(a,c){c.file&&(c.file.status=E.FAILED,b(c.file),a.state==E.STARTED&&(a.trigger("CancelUpload"),h(function(){R.call(a)},1)))}function N(a){a.stop(),E.each(B,function(a){a.destroy()}),B=[],$.length&&(E.each($,function(a){a.destroy()}),$=[]),X.length&&(E.each(X,function(a){a.destroy()}),X=[]),G={},Y=!1,L=j=null,H.reset()}var k,L,H,j,Q=E.guid(),B=[],G={},$=[],X=[],Y=!1;k={runtimes:o.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_chunk_number:!0},w.call(this,a,null,!0),H=new E.QueueProgress,E.extend(this,{id:Q,uid:Q,state:E.STOPPED,features:{},runtime:null,files:B,settings:k,total:H,init:function(){var a=this;return"function"==typeof k.preinit?k.preinit(a):E.each(k.preinit,function(c,g){a.bind(g,c)}),k.browse_button&&k.url?(S.call(this),void O.call(this,k,function(c){"function"==typeof k.init?k.init(a):E.each(k.init,function(c,g){a.bind(g,c)}),c?(a.runtime=o.Runtime.getInfo(y()).type,a.trigger("Init",{runtime:a.runtime}),a.trigger("PostInit")):a.trigger("Error",{code:E.INIT_ERROR,message:E.translate("Init error.")})})):void this.trigger("Error",{code:E.INIT_ERROR,message:E.translate("Init error.")})},setOption:function(a,c){w.call(this,a,c,!this.runtime)},getOption:function(a){return a?k[a]:k},refresh:function(){$.length&&E.each($,function(a){a.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=E.STARTED&&(this.state=E.STARTED,this.trigger("StateChanged"),R.call(this))},stop:function(){this.state!=E.STOPPED&&(this.state=E.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){Y=arguments[0]!==c?arguments[0]:!0,$.length&&E.each($,function(a){a.disable(Y)}),this.trigger("DisableBrowse",Y)},getFile:function(a){var i;for(i=B.length-1;i>=0;i--)if(B[i].id===a)return B[i]},addFile:function(a,c){function g(a,c){var g=[];o.each(v.settings.filters,function(c,h){_[h]&&g.push(function(g){_[h].call(v,c,a,function(a){g(!a)})})}),o.inSeries(g,c)}function R(a){var _=o.typeOf(a);if(a instanceof o.File){if(!a.ruid&&!a.isDetached()){if(!b)return!1;a.ruid=b,a.connectRuntime(b)}R(new E.File(a))}else a instanceof o.Blob?(R(a.getSource()),a.destroy()):a instanceof E.File?(c&&(a.name=c),z.push(function(c){g(a,function(g){g||(S.push(a),v.trigger("FileFiltered",a)),h(c,1)})})):-1!==o.inArray(_,["file","blob"])?R(new o.File(null,a)):"node"===_&&"filelist"===o.typeOf(a.files)?o.each(a.files,R):"array"===_&&(c=null,o.each(a,R))}var b,v=this,z=[],S=[];b=y(),R(a),z.length&&o.inSeries(z,function(){S.length&&v.trigger("FilesAdded",S)})},removeFile:function(a){for(var c="string"==typeof a?a:a.id,i=B.length-1;i>=0;i--)if(B[i].id===c)return this.splice(i,1)[0]},splice:function(a,g){var h=B.splice(a===c?0:a,g===c?B.length:g),_=!1;return this.state==E.STARTED&&(_=!0,this.stop()),this.trigger("FilesRemoved",h),E.each(h,function(a){a.destroy()}),this.trigger("QueueChanged"),this.refresh(),_&&this.start(),h},bind:function(a,c,g){var h=this;E.Uploader.prototype.bind.call(this,a,function(){var a=[].slice.call(arguments);return a.splice(0,1,h),c.apply(this,a)},0,g)},destroy:function(){this.trigger("Destroy"),k=H=null,this.unbindAll()}})},E.Uploader.prototype=o.EventTarget.instance,E.File=function(){function a(a){E.extend(this,{id:E.guid(),name:a.name||a.fileName,type:a.type||"",size:a.size||a.fileSize,origSize:a.size||a.fileSize,loaded:0,percent:0,status:E.QUEUED,lastModifiedDate:a.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var a=this.getSource().getSource();return-1!==o.inArray(o.typeOf(a),["blob","file"])?a:null},getSource:function(){return c[this.id]?c[this.id]:null},destroy:function(){var a=this.getSource();a&&(a.destroy(),delete c[this.id])}}),c[this.id]=a}var c={};return a}(),E.QueueProgress=function(){var a=this;a.size=0,a.loaded=0,a.uploaded=0,a.failed=0,a.queued=0,a.percent=0,a.bytesPerSec=0,a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}},a.plupload=E}(window,mOxie);